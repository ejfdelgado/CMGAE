var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},hayValor=function(a){return void 0!=a&&null!=a&&(!("string"==typeof a)||a.trim().length>0)},esFuncion=function(a){return"function"==typeof a},esNumero=function(a){return"number"==typeof a||/^\d+$/.test(a)},esBoolean=function(a){return"boolean"==typeof a},esObjeto=function(a){return"object"==(void 0===a?"undefined":_typeof(a))&&null!==a},esLista=function(a){return hayValor(a)&&a instanceof Array},esMultilenguaje=function(a){return/^(\S)+(\.\S+)+$/gim.test(a)},leerObj=function(a,t,e,o){if(!hayValor(t)||!esObjeto(a))return e;for(var r=t.split("."),n=a,i=0;i<r.length;i++){var d=r[i];if(esNumero(d)&&esLista(n)&&(d=parseInt(d)),n=n[d],i!=r.length-1&&!esObjeto(n))return e}return hayValor(n)?!0!==o&&esFuncion(n)?n():n:e},asignarObj=function(a,t,e){for(var o=t.split("."),r=a,n=0;n<o.length;n++){var i=o[n];esNumero(i)&&(i=parseInt(i)),esObjeto(r)&&(n==o.length-1?esLista(r[i])&&esLista(e)&&r[i]!==e?(r[i].splice(0,r[i].length),$.each(e,function(a,t){r[i].push(t)})):r[i]=e:((Object.keys(r).indexOf(""+i)<0||null==r[i])&&(esNumero(o[n+1])?r[i]=[]:r[i]={}),r=r[i]))}},darRutasObjeto=function(a,t){var e=[];return function a(o,r){esObjeto(o)?$.each(o,function(o,n){var i=null;i=null===r?o:r+"."+o,esFuncion(t)&&t(n)&&e.push(i),a(n,i)}):null!==r&&(esFuncion(t)?t(o)&&e.push(r):e.push(r))}(a,null),e},predefinir=function(a,t){for(var e=darRutasObjeto(t),o=0;o<e.length;o++){var r=e[o];if(!hayValor(leerObj(a,r,null,!0))){var n=leerObj(t,r,null,!0);asignarObj(a,r,n)}}return a},configurarListasEditor=function(a,t){a.use(new a.RdfaService);for(var e in t){for(var o=e+"Rel",r=t[e],n=[],i=0;i<r.campos.length;i++){var d=r.campos[i];n.push({id:d.nombre,range:d.tipo,min:0,max:1})}a.types.add(e,n);for(var c=0;c<r.listas.length;c++){var l=r.listas[c];a.types.add(l.nombre,[{id:o,range:e,min:0,max:-1}])}a.service("rdfa").setTemplate(e,o,jQuery(r.ejemplo).html())}},tieneAtributo=function(a,t){var e=a.attr(t);return"undefined"!==(void 0===e?"undefined":_typeof(e))&&!1!==e},activarConteoRegresivo=function(){$(".mycountdown").each(function(a,t){var e=$(t),o=e.text(),r=e.attr("data-count-format");e.countdown(o,function(a){$(this).text(a.strftime(r))})})};if(!hayValor(moduloActividad))var moduloActividad=function(){var a=0;return{on:function(t){if(hayValor(t)||(t=""),0==a){var e=$('<div id="loading"><p></p></div>');e.find("p").html(t),$("body").append(e)}a++},off:function(){--a<=0&&(a=0,$("#loading").remove())}}}();if(!hayValor(moduloHttp))var moduloHttp=function(){return{get:function(a){var t=$.Deferred();return moduloActividad.on(),$.ajax({url:a,type:"GET",cache:!1}).done(function(a){t.resolve(a)}).fail(function(){t.reject()}).always(function(){moduloActividad.off()}),t.promise()}}}();if(!hayValor(moduloLocal))var moduloLocal=function(){var a={lengua:LENGUAJE,lenguapred:LENGUAJE_PRED},t=null,e=function(a){return esObjeto(t)?leerObj(t,a,a):a},o=function(a){$.each(a.find(".traducir"),function(a,t){var o=$(t),r=o.text();if(esMultilenguaje(r)){var n=e(r);n!=r&&o.html(n)}})},r=function(a,t){var e=a.attr("data-value");if(e){var o=new Date(0);try{o.setUTCSeconds(parseInt(e))}catch(a){}if(a.find("[data-format]").each(function(a,t){var e=$(t),r=e.attr("data-format"),n=$.format.date(o.getTime(),r);e.text(n)}),void 0!==t)return $.format.date(o.getTime(),t)}return""},n=function(a){a.find("[dateProperty]").each(function(a,t){var e=$(t);r(e)})},i=function(){$("[data-lenguaje]").each(function(t,e){var o=$(e),r=o.attr("data-lenguaje");o.off("click","**"),o.on("click",function(){var t=/(http)(s?)(:)(\/\/)(.*?)(\/)((leng-)(.*?)(\/))?(.*)/g.exec(window.location);if(t){for(var e="",o=!0,n=t[9],i=r===a.lenguapred,d=1;d<t.length;d++){var c=t[d];if(d<=6||d>=11)void 0!==c&&(e+=c);else{if(i){if(void 0===n)return}else if(n===r)return;!i&&o&&(e+="leng-"+r+"/",o=!1)}}window.location=e}})})};return function(){var e=moduloHttp.get("/assets/cmgae/local/"+a.lengua+".json");$.when(e).then(function(a){t=JSON.parse(a)}),n($("body")),i()}(),{traducir:e,procesarElemento:o,epochAFechaElem:n}}();if(!hayValor(moduloApp))var moduloApp=function(){var a={URL_LOGIN:URL_LOGIN,URL_LOGOUT:URL_LOGOUT,HAS_USER:HAS_USER,IS_ADMIN:IS_ADMIN},t=function(){return a.IS_ADMIN},e=function(){return a.HAS_USER},o=function(){moduloActividad.on(),window.location.href=a.URL_LOGIN},r=function(){moduloActividad.on(),window.location.href=a.URL_LOGOUT},n=function(){"full"===$("body").data("Midgard-midgardToolbar").options.display?($("body").data("Midgard-midgardToolbar").__proto__.hide(),$("body").data("Midgard-midgardToolbar").options.display="minimized"):($("body").data("Midgard-midgardToolbar").__proto__.show(),$("body").data("Midgard-midgardToolbar").options.display="full")};return{esAdmin:t,esUsuario:e,login:o,logout:r,borrarCache:function(){var a=$.Deferred();return moduloActividad.on(),$.ajax({type:"GET",url:"/act/clearmemcache",data:JSON.stringify({}),contentType:"application/json; charset=utf-8"}).done(function(t){a.resolve()}).fail(function(t,e){a.reject()}).always(function(){moduloActividad.off()}),a.promise()},abrirBarraEdicion:n}}();if(!hayValor(moduloArchivos))var moduloArchivos=function(){var a=function(a){var t={maximoTamanio:512e3,tipos:"image/*",auto:"true",dataFolder:"/imagenesbasico"};for(var e in t)hayValor(a[e])||(a[e]=t[e]);return a},t=function(t){var e=$.Deferred();t=a(t);var o=$('<input type="file" class="invisible" accept="'+t.tipos+'">');return o.on("change",function(a){var o=a.target.files[0];if(o.size>t.maximoTamanio)return alert("Archivo muy grande! debe ser menor a "+t.maximoTamanio/1024+" KB"),void e.reject();(new FileReader).readAsDataURL(o);var r=new FormData;r.append("file-0",o),r.append("folder",t.dataFolder),hayValor(t.id)&&r.append("name",t.id),"false"==t.auto&&r.append("auto","false"),moduloActividad.on(),$.ajax({url:"/storage/",type:"POST",data:r,headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(a){0!=a.error?e.reject():e.resolve(a)}).fail(function(){e.reject()}).always(function(){moduloActividad.off()})}),o.click(),e.promise()},e=function(a,t){var e=$.Deferred(),o={type:"text/plain"},r=new File([t],a,o),n=new FormData;return n.append("file-0",r),n.append("auto","false"),n.append("name",a),moduloActividad.on(),$.ajax({url:"/storage/",type:"POST",data:n,headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(a){0!=a.error?e.reject():e.resolve()}).fail(function(){e.reject()}).always(function(){moduloActividad.off()}),e.promise()};return{leerTextoPlano:function(a){var t=$.Deferred();return moduloActividad.on(),$.ajax({url:"/storage/read?name="+encodeURIComponent(a),type:"GET",cache:!1,contentType:!1,processData:!1}).done(function(a){t.resolve(a)}).fail(function(){t.reject()}).always(function(){moduloActividad.off()}),t.promise()},escribirTextoPlano:e,subirArchivo:t}}();if(!hayValor(moduloMenus))var moduloMenus=function(){var a=[],t=function(a){return moduloHttp.get("/assets/cmgae/menus"+a)},e=function(t){return 0!=a.length&&a[a.length-1].id==t},o=function(){if(0!=a.length){a[a.length-1].nodo.remove(),a.pop()}},r=function(a){var e=t("/soloTexto.html");$.when(e).then(function(t){l("alerta",t,{html:{".mensaje_texto":a}})})},n=function(){r(moduloLocal.traducir("menus.mensajes.error"))},i=function(a){$.when(a).then(function(){r(moduloLocal.traducir("menus.mensajes.hecho"))},n)},d=function(a,t){moduloLocal.procesarElemento(a);var e={funciones:{".menu_opc_ingresar":moduloApp.login,".menu_opc_salir":moduloApp.logout,".menu_opc_borrar_cache":moduloApp.borrarCache,".create-ui-toggle2":moduloApp.abrirBarraEdicion,".menuEliminar":moduloEdicion.funcElegirBorrar},html:{},botones:{}};if(e=$.extend(e,t),$.each(e.funciones,function(t,e){a.find(t).on("click",function(){o();var a=e();hayValor(a)&&i(a)})}),esObjeto(e.botones)){var r=$('<div class="row"><div class="col-xs-12"><div class="text-right botones-aca"></div></div></div>'),n={texto:"?",clase:"btn-primary",accion:function(){}};$.each(e.botones,function(a,t){predefinir(t,n);var e=$('<button type="button" class="btn btn-xs"></button>');e.on("click",t.accion),e.addClass(t.clase),e.text(t.texto),r.find(".botones-aca").append(e)}),a.append(r)}for(var d in e.html)a.find(d).html(e.html[d])},c=function(){var a=t("/confirmar.html"),e=$.Deferred();return $.when(a).then(function(a){var t={botones:{aceptar:{texto:moduloLocal.traducir("menus.botones.aceptar"),clase:"btn-success",accion:function(){e.resolve()}},cancelar:{texto:moduloLocal.traducir("menus.botones.cancelar"),clase:"btn-danger",accion:function(){e.reject()}}}};l("confirmacion",a,t)}),e.promise()},l=function(t,e,o){var r=$(e);$("body").append(r),a.push({id:t,nodo:r}),d(r,o)},u=function(){var a=$.Deferred();if(e("menu"))return o(),a.reject(),a.promise();var r=null;return r=t(moduloApp.esUsuario()?moduloApp.esAdmin()?"/menuInicialAdmin.html":"/menuInicialAnonimo.html":"/menuInicialAnonimo.html"),$.when(r).then(function(t){l("menu",t),a.resolve()}),a.promise()},s=function(){pila.push("menu_pagina"),$(".menu_core").toggleClass("invisible"),$(".menu_pagina").toggleClass("invisible"),window.scrollTo(0,0)},f=function(a,t,e,o){pila.push("formhtml"),$(".formhtml").attr("nodo2",a),$(".formhtml").attr("property2",t),$(".formhtml").attr("sufijo",o),$(".formhtml textarea").val(e),$(".formhtml").removeClass("invisible")};return $(document).keyup(function(t){27==t.keyCode&&(0==a.length?u():o())}),{mostrarMenuPagina:s,mostrarFormularioEdicion:f,mostrarMenuBasico:u,mostrarMenuSoloTexto:r,confirmar:c,sacarUltimo:o,error:n}}();if(!hayValor(moduloEdicion))var moduloEdicion=function(){var mapaIds={},activarEdicionOk=!1,activarEdicion=function(){1!=activarEdicionOk&&"undefined"!=typeof Backbone&&(Backbone.sync=function(a,t,e){try{var o=t.toJSON(),r=o["@subject"];t.isNew()&&(r in mapaIds?o["@subject"]=mapaIds[r]:(o["@subject"]="<"+(new Date).getTime()+"_"+Math.floor(10*Math.random()+1)+">",mapaIds[r]=o["@subject"]));var n=o["@subject"],i=o["@type"],d=/(viejs\.org\/ns\/)(.*)(>)/g.exec(i),c=null;d&&(c=d[2]);var l=/(<)(.*)(>)/g,u=l.exec(n);if(null==u)return void e.error("error: no es identificador "+n);var s=u[2],f={};for(var p in o){var d=/(viejs\.org\/ns\/)(.*)(>)/g.exec(p);d&&(f[d[2]]=o[p])}var m={};switch(m.payload=f,m.leng=LENGUAJE,a){case"create":case"update":moduloActividad.on(),$.ajax({type:"PUT",url:"/rest/"+(null===c||void 0===c?"Documento":c)+"/"+s,data:JSON.stringify(m),contentType:"application/json; charset=utf-8"}).done(function(a){e.success(t)}).fail(function(a,t){e.error("error")}).always(function(){moduloActividad.off()})}}catch(a){e.error("error "+a)}},activarEdicionOk=!0)},activarPaginacion=function activarPaginacion(nodo){function activatePageA(actual){var cursor=actual.attr("data-next"),busqueda=JSON.parse(actual.attr("data-q")),template=actual.attr("data-tpl"),target=actual.attr("data-target"),ipage=parseInt(actual.attr("data-page"));busqueda.n||(busqueda.n=100),moduloApp.esAdmin()||actual.html(ipage*busqueda.n+1+" al "+(ipage+1)*busqueda.n),"1"===actual.attr("data-noa")&&(actual.removeAttr("href"),actual.on("click",function(){var docHtml=document.getElementById(template).innerHTML,destino=$(target),postload=destino.attr("data-postload");destino.length>0&&(moduloActividad.on(),$.ajax({type:"PUT",url:"/paginar/",data:JSON.stringify({busqueda:busqueda,cursor:cursor}),contentType:"application/json; charset=utf-8"}).done(function(msg){var datos=msg.datos,sigui=msg.next;destino.empty();for(var i=0;i<datos.length;i++){var dato=datos[i],nuevo=$(docHtml);llenarTemplate(nuevo,dato),destino.append(nuevo)}if(void 0!==sigui&&sigui.length>0){var padrePaginacion=actual.closest(".paginacion");if(0==padrePaginacion.find("[data-next='"+sigui+"']").length){for(var padreLocal=actual.parent(),nombreTAG=padreLocal.prop("tagName"),cambio=!1;padreLocal.get(0)!=padrePaginacion.get(0)&&"BODY"!=nombreTAG;)cambio=!0,actual=padreLocal,padreLocal=padreLocal.parent(),nombreTAG=padreLocal.prop("tagName");var paginaSigui=actual.clone(),paginaSigui2;paginaSigui2=cambio?paginaSigui.find("[data-next]"):paginaSigui,paginaSigui2.attr("data-page",ipage+1),paginaSigui2.attr("data-next",sigui),padrePaginacion.append(paginaSigui),activatePageA(paginaSigui2)}}void 0!==postload&&eval(postload)}).fail(function(a,t){moduloMenus.mostrarMenuSoloTexto("Error paginando")}).always(function(){moduloActividad.off()}))}))}hayValor(nodo)||(nodo=$("body")),$.each(nodo.find("a[data-next]"),function(a,t){activatePageA($(t))})},funcElegirBorrar=function(){var a=$(".btnEliminar");a.length>0?a.remove():$("[about]").each(function(a,t){var e=$(t),o=e.find(".btnEliminar");if(0==o.length){e.prepend($('<div class="btnEliminar"><div class="btnEliminarX btnEliminar2 manito"></div></div>')),o=e.find(".btnEliminar");o.find(".btnEliminar2").click(function(){var a=moduloMenus.confirmar();$.when(a).then(function(){var a=e,t=a.attr("about"),o=null;o=a.attr("typeof");var r=(hayValor(o)?o:"")+"_"+t;r in mapaIds&&(t=mapaIds[r]),moduloActividad.on(),$.ajax({type:"DELETE",url:"/rest/"+(hayValor(o)?o:"")+"/"+t}).done(function(t){a.remove(),$("body").data("Midgard-midgardNotifications").create({body:JSON.stringify(t)}),location.reload()}).fail(function(a,t){$("body").data("Midgard-midgardNotifications").create({body:TRADUCTOR.error_ajax[LENGUAJE]})}).always(function(){moduloActividad.off()}),moduloMenus.sacarUltimo()},function(){moduloMenus.sacarUltimo()})})}}),"menu"===pila[pila.length-1]&&pila.pop()};return activarPaginacion(),{activarPaginacion:activarPaginacion,activarEdicion:activarEdicion,funcElegirBorrar:funcElegirBorrar}}();if(!hayValor(moduloContactenos))var moduloContactenos=function(){function a(a,t,e){var o="div",r=a.prop("tagName");"UL"!=r&&"OL"!=r||(o="li");var n=$("<"+o+' property="'+e+'" class="'+e+'"></'+o+">");n.text(t),a.prepend(n)}function t(a){var t=a.attr("validacion"),e=a.attr("placeholder");if(void 0===e&&(e=a.attr("name")),void 0!==t){void 0===e&&(e=t);var o=new RegExp(t,"gi");if(!a.val().match(o))return{error:1,msg:moduloLocal.traducir("general.verifique")+e}}return{error:0}}function e(a,t){a.find("input[type=text],select,textarea").each(function(a,e){var o=$(e),r=o.attr("name");void 0===r&&(r=o.attr("placeholder")),r in t&&o.val(t[r])}),a.find("input[type=checkbox]").each(function(a,e){var o=$(e),r=o.attr("name");void 0===r&&(r=o.attr("placeholder")),r in t&&(1==t[r]?o.prop("checked",!0):o.prop("checked",!1))}),a.find("input[type=radio]").each(function(a,e){var o=$(e),r=o.attr("name");void 0===r&&(r=o.attr("placeholder")),r in t&&(t[r]==o.attr("value")?o.prop("checked",!0):o.prop("checked",!1))})}function o(a,e){var o=[];return a.find("input[type=text],textarea").each(function(a,e){var r=$(e),n=t(r);o.push(n)}),a.find("input[type=text],select,textarea,input[type=radio]:checked").each(function(a,t){var o=$(t),r=o.attr("name");if(void 0===r&&(r=o.attr("placeholder")),void 0!==r){var n=o.val();e[r]=n}}),a.find("input[type=checkbox]").each(function(a,t){var o=$(t),r=o.attr("name");if(void 0===r&&(r=o.attr("placeholder")),void 0!==r){var n=o.is(":checked")?1:0;e[r]=n}}),o}return function(){$(".contenedor-envio-mensajes[data-preload]").each(function(a,t){var o=$(this),r=o.attr("data-preload");void 0!==r&&0!=r.length&&$.ajax({type:"GET",url:r,contentType:"application/json; charset=utf-8"}).done(function(a){e(o,a)}).fail(function(a,t){moduloMenus.error()})}),$(".boton-envio-mensaje").on("click",function(){moduloActividad.on();var t=$(this),e=t.attr("data-url");void 0!==e&&0!=e.length||(e="/act/correo");var r=t.attr("data-once");r=void 0===r||0==r.length;var n=t.closest(".contenedor-envio-mensajes");if(n){n.find("[property='error']").remove(),n.find('[property="gracias"]').addClass("invisible");for(var i={},d=o(n,i),c=0,l=0;l<d.length;l++){var u=d[l];0!=u.error&&(a(n,u.msg,"error"),c++)}if(c>0)return void moduloActividad.off();$.ajax({type:"PUT",url:e,data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(t){0==t.error?(r&&n.children().addClass("invisible"),n.find('[property="gracias"]').removeClass("invisible")):a(n,t.msg,"error"),moduloActividad.off()}).fail(function(t,e){a(n,e,"error"),moduloActividad.off()})}})}(),{}};!function(a){function t(t){t.find("[styleProperty]").each(function(t,e){var o=a(e);if("ok"!==o.attr("act_style")){var r,n=o.attr("styleProperty");if(void 0===(r=void 0!==o.attr("about")?o:o.closest("[about]")))return;o.on("click",function(a){if(a.shiftKey){var t=o.attr("style");moduloMenus.mostrarFormularioEdicion(r.attr("about"),n,t)}else a.ctrlKey&&u(o,n)}),o.attr("act_style","ok")}})}function e(t){t.find("img[property]").each(function(t,e){var o=a(e);"ok"!==o.attr("act_img")&&(a(e).on("click",function(t){var o=a(e);t.altKey?l(o):u(o)}),o.attr("act_img","ok"))})}function o(t){t.find(".editable").each(function(t,e){var o=a(e);if("ok"!==o.attr("act_edt")&&(o.on("click",function(){var t=o.closest("[about]");if(t){if("none"===a("#midgardcreate-save").css("display"))return;moduloMenus.mostrarFormularioEdicion(t.attr("about"),o.attr("property"),o.html())}}),o.attr("act_edt","ok"),!o.hasClass("textarea_background"))){var r=a('<button type="button" style="padding: 5px !important;">editar</button>');r.bind("click",function(){o.click()}),o.after(r)}})}function r(t){t.find('[textplain="true"]').each(function(t,e){var o=a(e);"ok"!==o.attr("act_tpl")&&(o.on("blur",function(){o.html(o.text())}),o.attr("act_tpl","ok"))})}function n(t){t.find("[dateProperty]").each(function(t,e){var o=a(e),r=o.attr("dateProperty");if("ok"!==o.attr("act_date")){var n=o.closest("[about]");if(n){var d=formatearFecha(o,"dd/MM/yyyy"),c=a('<input style="display: none;" class="datepicker" type="text" autofocuss value="'+d+'" data-valuee="'+d+'"></input>');n.append(c),o.click(function(){c.click()});var l=a('<div style="display: none;" property="'+r+'">'+o.attr("data-value")+"</div>");n.append(l),c.on("change",function(){var t=r,e={},d="0";try{d=parseInt(toDate(c.val()).getTime()/1e3)}catch(a){}e[t]=d;var u=i.entities.get(n.attr("about"));u.set(e);var s=a("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(s,u)&&s.push(u),a("#midgardcreate-save").button({disabled:!1}),o.attr("data-value",d),l.text(d),formatearFecha(o)}),c.pickadate({format:"dd/mm/yyyy",formatSubmit:"dd/mm/yyyy",closeOnSelect:!0,closeOnClear:!0,selectMonths:!0,selectYears:!0})}o.attr("act_date","ok")}})}var i=getVieHere(),d=function(t,e,o,r,n){var i="[about='"+e+"'] [property='"+o+"']",d="[about='"+e+"'] [styleProperty='"+o+"'],[about='"+e+"'][styleProperty='"+o+"']";hayValor(n)||(n="");var c=function(){var i={};i[o+n]=r;var d=t.entities.get(e);d.set(i);var c=a("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(c,d)&&c.push(d),a("#midgardcreate-save").button({disabled:!1})},l=a(i),u=a(d);if(l.length>0){"IMG"==l.prop("tagName")&&("_alt"==n?l.attr("alt",r):l.attr("src",r)),c()}else u.length>0&&(r=r.replace(/"/g,"&quot;"),u.attr("style",r),c())};a("body").append(a('<input type=\'file\' id="formularioImagenes" class="fileEscondido" nodo2="" property2="" />')),a("body").append(a('<div class="formhtml invisible">\t<div class="ctrles"><a class="guardar">Guardar</a>&nbsp;<a class="cancelar">Cancelar</a></div>\t<div class="boxtexto">\t<textarea></textarea>\t</div></div>')),t(a("body"));var c=function(t,e){var o={ok:!1};return"none"===a("#midgardcreate-save").css("display")?o:(void 0!==t.attr("about")?o.padre=t:o.padre=t.closest("[about]"),void 0===o.padre?o:(o.ident=o.padre.attr("about"),hayValor(e)?o.propiedad=e:o.propiedad=t.attr("property"),void 0===o.ident||void 0===o.propiedad?o:(o.ok=!0,o)))},l=function(a){if("IMG"===a.prop("tagName")){var t=c(a);0!=t.ok&&moduloMenus.mostrarFormularioEdicion(t.ident,t.propiedad,a.attr("alt"),"_alt")}},u=function(t,e){var o=c(t,e);if(0!=o.ok){var r=/(background-image\s*:\s*url\s*\(\s*['"]?)([^'^"]*?)(\s*['"]?\))\s*(!\s*important)?\s*(;)?/gi,n=function(a){var o="http://storage.googleapis.com"+a+"?"+(new Date).getTime();if(hayValor(e)){var n=t.attr("style");return n=n.replace(r,""),n=n.trim(),hayValor(n)&&!n.endsWith(";")&&(n+=";"),n+="background-image: url('"+o+"') !important;",t.attr("style",n),n}return t.attr("src",o),o},l=512e3,u="/imagenesbasico";try{var s=t.attr("data-max");hayValor(s)&&(l=1024*parseInt(s))}catch(a){console.log("Intentó determinar tamaño máximo de imagen pero falló")}var f=t.attr("data-carpeta");"undefined"!==(void 0===f?"undefined":_typeof(f))&&!1!==f&&(f=f.trim(),hayValor(f)&&("/"!=f.charAt(0)&&(f="/"+f),u+=f));var p=moduloArchivos.subirArchivo({dataFolder:u,id:function(){var a=/^(https?:\/\/storage\.googleapis\.com)([^\?]*)(\?.*)?$/gi,o=null;if(hayValor(e)){var n=t.attr("style"),i=r.exec(n);null!=i&&i.length>3&&(o=i[2])}else o=t.attr("src");if(!hayValor(o))return null;var d=a.exec(o);return null!=d&&d.length>=3?d[2]:null}(),maximoTamanio:l});a.when(p).then(function(a){var t=n(a.id);d(i,o.ident,o.propiedad,t)})}};e(a("body")),o(a("body")),r(a("body")),n(a("body")),a("body").bind("midgardeditableenable",function(i,d){var c=d.entity["@subject"],l=/(<)(.*)(>)/g,u=l.exec(c);u=u?u[2]:c;var s=a("[about='"+u+"']");void 0!==s&&(t(s),e(s),o(s),r(s),n(s))}),a("body").midgardCreate({url:function(){return"javascript:false;"},vie:i,highlight:!1,collectionWidgets:{default:"midgardCollectionAdd"}}),configureEditorsHere();a(".formhtml .cancelar").click(function(){a(".formhtml").addClass("invisible"),"formhtml"===pila[pila.length-1]&&pila.pop()}),a(".formhtml .guardar").click(function(){try{var t=a(".formhtml"),e=t.attr("nodo2"),o=t.attr("property2"),r=t.attr("sufijo"),n=a(".formhtml textarea").val();d(i,e,o,n,r),a(".formhtml").addClass("invisible"),"formhtml"===pila[pila.length-1]&&pila.pop()}catch(t){a("body").data("Midgard-midgardNotifications").create({body:"Error "+t})}}),a("#formularioImagenes").change(function(){if(this.files&&this.files[0]){var t=new FileReader;t.onload=function(t){var e=a("#formularioImagenes"),o=e.attr("nodo2"),r=e.attr("property2"),n=a("[about='"+o+"'] [property='"+r+"']"),d={};if(d[r]=t.target.result,n){"IMG"==n.prop("tagName")?n.attr("src",t.target.result):n.attr("style","background-image: url('"+t.target.result+"') !important");var c=i.entities.get(o);c.set(d);var l=a("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(l,c)&&l.push(c),a("#midgardcreate-save").button({disabled:!1})}},t.readAsDataURL(this.files[0])}}),a("textarea[property]").on("change keyup paste",function(){self=a(this);var t=self.attr("property"),e=self.closest("[about]");if(e){var o=e.attr("about"),r=self.val(),n={};n[t]=r;var d=i.entities.get(o);d.set(n);var c=a("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(c,d)&&c.push(d),a("#midgardcreate-save").button({disabled:!1})}})}(jQuery);