var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},hayValor=function(a){return void 0!=a&&null!=a&&(!("string"==typeof a)||a.trim().length>0)},esFuncion=function(a){return"function"==typeof a},esNumero=function(a){return"number"==typeof a||/^\d+$/.test(a)},esBoolean=function(a){return"boolean"==typeof a},esObjeto=function(a){return"object"==(void 0===a?"undefined":_typeof(a))&&null!==a},esLista=function(a){return hayValor(a)&&a instanceof Array},esMultilenguaje=function(a){return/^(\S)+(\.\S+)+$/gim.test(a)},leerObj=function(a,t,o,e){if(!hayValor(t)||!esObjeto(a))return o;for(var n=t.split("."),r=a,i=0;i<n.length;i++){var d=n[i];if(esNumero(d)&&esLista(r)&&(d=parseInt(d)),r=r[d],i!=n.length-1&&!esObjeto(r))return o}return hayValor(r)?!0!==e&&esFuncion(r)?r():r:o},asignarObj=function(a,t,o){for(var e=t.split("."),n=a,r=0;r<e.length;r++){var i=e[r];esNumero(i)&&(i=parseInt(i)),esObjeto(n)&&(r==e.length-1?esLista(n[i])&&esLista(o)&&n[i]!==o?(n[i].splice(0,n[i].length),$.each(o,function(a,t){n[i].push(t)})):n[i]=o:((Object.keys(n).indexOf(""+i)<0||null==n[i])&&(esNumero(e[r+1])?n[i]=[]:n[i]={}),n=n[i]))}},darRutasObjeto=function(a,t){var o=[];return function a(e,n){esObjeto(e)?$.each(e,function(e,r){var i=null;i=null===n?e:n+"."+e,esFuncion(t)&&t(r)&&o.push(i),a(r,i)}):null!==n&&(esFuncion(t)?t(e)&&o.push(n):o.push(n))}(a,null),o},predefinir=function(a,t){for(var o=darRutasObjeto(t),e=0;e<o.length;e++){var n=o[e];if(!hayValor(leerObj(a,n,null,!0))){var r=leerObj(t,n,null,!0);asignarObj(a,n,r)}}return a};if(!hayValor(moduloActividad))var moduloActividad=function(){var a=0;return{on:function(t){if(hayValor(t)||(t=""),0==a){var o=$('<div id="loading"><p></p></div>');o.find("p").html(t),$("body").append(o)}a++},off:function(){--a<=0&&(a=0,$("#loading").remove())}}}();if(!hayValor(moduloHttp))var moduloHttp=function(){return{get:function(a){var t=$.Deferred();return moduloActividad.on(),$.ajax({url:a,type:"GET",cache:!1}).done(function(a){t.resolve(a)}).fail(function(){t.reject()}).always(function(){moduloActividad.off()}),t.promise()}}}();if(!hayValor(moduloLocal))var moduloLocal=function(){var a={lengua:LENGUAJE},t=null,o=function(a){return esObjeto(t)?leerObj(t,a,a):a},e=function(a){$.each(a.find(".traducir"),function(a,t){var e=$(t),n=e.text();if(esMultilenguaje(n)){var r=o(n);r!=n&&e.html(r)}})};return function(){var o=moduloHttp.get("/assets/cmgae/local/"+a.lengua+".json");$.when(o).then(function(a){t=JSON.parse(a)})}(),{traducir:o,procesarElemento:e}}();if(!hayValor(moduloApp))var moduloApp=function(){var a={URL_LOGIN:URL_LOGIN,URL_LOGOUT:URL_LOGOUT,HAS_USER:HAS_USER,IS_ADMIN:IS_ADMIN},t=function(){return a.IS_ADMIN},o=function(){return a.HAS_USER},e=function(){moduloActividad.on(),window.location.href=a.URL_LOGIN},n=function(){moduloActividad.on(),window.location.href=a.URL_LOGOUT},r=function(){"full"===$("body").data("Midgard-midgardToolbar").options.display?($("body").data("Midgard-midgardToolbar").__proto__.hide(),$("body").data("Midgard-midgardToolbar").options.display="minimized"):($("body").data("Midgard-midgardToolbar").__proto__.show(),$("body").data("Midgard-midgardToolbar").options.display="full")};return{esAdmin:t,esUsuario:o,login:e,logout:n,borrarCache:function(){var a=$.Deferred();return moduloActividad.on(),$.ajax({type:"GET",url:"/act/clearmemcache",data:JSON.stringify({}),contentType:"application/json; charset=utf-8"}).done(function(t){a.resolve()}).fail(function(t,o){a.reject()}).always(function(){moduloActividad.off()}),a.promise()},abrirBarraEdicion:r}}();if(!hayValor(moduloArchivos))var moduloArchivos=function(){var a=function(a){var t={maximoTamanio:512e3,tipos:"image/*",auto:"true",dataFolder:"/imagenesbasico"};for(var o in t)hayValor(a[o])||(a[o]=t[o]);return a},t=function(t){var o=$.Deferred();t=a(t);var e=$('<input type="file" class="invisible" accept="'+t.tipos+'">');return e.on("change",function(a){var e=a.target.files[0];if(e.size>t.maximoTamanio)return alert("Archivo muy grande! debe ser menor a "+t.maximoTamanio/1024+" KB"),void o.reject();(new FileReader).readAsDataURL(e);var n=new FormData;n.append("file-0",e),n.append("folder",t.dataFolder),hayValor(t.id)&&n.append("name",t.id),"false"==t.auto&&n.append("auto","false"),moduloActividad.on(),$.ajax({url:"/storage/",type:"POST",data:n,headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(a){0!=a.error?o.reject():o.resolve(a)}).fail(function(){o.reject()}).always(function(){moduloActividad.off()})}),e.click(),o.promise()},o=function(a,t){var o=$.Deferred(),e={type:"text/plain"},n=new File([t],a,e),r=new FormData;return r.append("file-0",n),r.append("auto","false"),r.append("name",a),moduloActividad.on(),$.ajax({url:"/storage/",type:"POST",data:r,headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(a){0!=a.error?o.reject():o.resolve()}).fail(function(){o.reject()}).always(function(){moduloActividad.off()}),o.promise()};return{leerTextoPlano:function(a){var t=$.Deferred();return moduloActividad.on(),$.ajax({url:"/storage/read?name="+encodeURIComponent(a),type:"GET",cache:!1,contentType:!1,processData:!1}).done(function(a){t.resolve(a)}).fail(function(){t.reject()}).always(function(){moduloActividad.off()}),t.promise()},escribirTextoPlano:o,subirArchivo:t}}();if(!hayValor(moduloMenus))var moduloMenus=function(){var a=[],t=function(a){return moduloHttp.get("/assets/cmgae/menus"+a)},o=function(t){return 0!=a.length&&a[a.length-1].id==t},e=function(){if(0!=a.length){a[a.length-1].nodo.remove(),a.pop()}},n=function(a){var o=t("/soloTexto.html");$.when(o).then(function(t){c("alerta",t,{html:{".mensaje_texto":a}})})},r=function(){n(moduloLocal.traductir("menus.mensajes.error"))},i=function(a){$.when(a).then(function(){n(moduloLocal.traductir("menus.mensajes.hecho"))},r)},d=function(a,t){moduloLocal.procesarElemento(a);var o={funciones:{".menu_opc_ingresar":moduloApp.login,".menu_opc_salir":moduloApp.logout,".menu_opc_borrar_cache":moduloApp.borrarCache,".create-ui-toggle2":moduloApp.abrirBarraEdicion,".menuEliminar":moduloEdicion.funcElegirBorrar},html:{},botones:{}};if(o=$.extend(o,t),$.each(o.funciones,function(t,o){a.find(t).on("click",function(){e();var a=o();hayValor(a)&&i(a)})}),esObjeto(o.botones)){var n=$('<div class="row"><div class="col-xs-12"><div class="text-right botones-aca"></div></div></div>'),r={texto:"?",clase:"btn-primary",accion:function(){}};$.each(o.botones,function(a,t){predefinir(t,r);var o=$('<button type="button" class="btn btn-xs"></button>');o.on("click",t.accion),o.addClass(t.clase),o.text(t.texto),n.find(".botones-aca").append(o)}),a.append(n)}for(var d in o.html)a.find(d).html(o.html[d])},l=function(){var a=t("/confirmar.html"),o=$.Deferred();return $.when(a).then(function(a){var t={botones:{aceptar:{texto:moduloLocal.traducir("menus.botones.aceptar"),clase:"btn-success",accion:function(){o.resolve()}},cancelar:{texto:moduloLocal.traducir("menus.botones.cancelar"),clase:"btn-danger",accion:function(){o.reject()}}}};c("confirmacion",a,t)}),o.promise()},c=function(t,o,e){var n=$(o);$("body").append(n),a.push({id:t,nodo:n}),d(n,e)},u=function(){var a=$.Deferred();if(o("menu"))return e(),a.reject(),a.promise();var n=null;return n=t(moduloApp.esUsuario()?moduloApp.esAdmin()?"/menuInicialAdmin.html":"/menuInicialAnonimo.html":"/menuInicialAnonimo.html"),$.when(n).then(function(t){c("menu",t),a.resolve()}),a.promise()},s=function(){pila.push("menu_pagina"),$(".menu_core").toggleClass("invisible"),$(".menu_pagina").toggleClass("invisible"),window.scrollTo(0,0)},f=function(a,t,o,e){pila.push("formhtml"),console.log("mostrarFormularioEdicion",a,t,o),$(".formhtml").attr("nodo2",a),$(".formhtml").attr("property2",t),$(".formhtml").attr("sufijo",e),$(".formhtml textarea").val(o),$(".formhtml").removeClass("invisible")};return $(document).keyup(function(t){27==t.keyCode&&(0==a.length?u():e())}),{mostrarMenuPagina:s,mostrarFormularioEdicion:f,mostrarMenuBasico:u,mostrarMenuSoloTexto:n,confirmar:l,sacarUltimo:e,error:r}}();if(!hayValor(moduloEdicion))var moduloEdicion=function(){var mapaIds={},activarEdicionOk=!1,activarEdicion=function(){1!=activarEdicionOk&&"undefined"!=typeof Backbone&&(Backbone.sync=function(a,t,o){try{var e=t.toJSON(),n=e["@subject"];t.isNew()&&(n in mapaIds?e["@subject"]=mapaIds[n]:(e["@subject"]="<"+(new Date).getTime()+"_"+Math.floor(10*Math.random()+1)+">",mapaIds[n]=e["@subject"]));var r=e["@subject"],i=e["@type"],d=/(viejs\.org\/ns\/)(.*)(>)/g.exec(i),l=null;d&&(l=d[2]);var c=/(<)(.*)(>)/g,u=c.exec(r);if(null==u)return void o.error("error: no es identificador "+r);var s=u[2],f={};for(var p in e){var d=/(viejs\.org\/ns\/)(.*)(>)/g.exec(p);d&&(f[d[2]]=e[p])}var m={};switch(m.payload=f,m.leng=LENGUAJE,a){case"create":case"update":moduloActividad.on(),$.ajax({type:"PUT",url:"/rest/"+(null===l||void 0===l?"Documento":l)+"/"+s,data:JSON.stringify(m),contentType:"application/json; charset=utf-8"}).done(function(a){o.success(t)}).fail(function(a,t){o.error("error")}).always(function(){moduloActividad.off()})}}catch(a){o.error("error "+a)}},activarEdicionOk=!0)},activarPaginacion=function activarPaginacion(nodo){function activatePageA(actual){var cursor=actual.attr("data-next"),busqueda=JSON.parse(actual.attr("data-q")),template=actual.attr("data-tpl"),target=actual.attr("data-target"),ipage=parseInt(actual.attr("data-page"));busqueda.n||(busqueda.n=100),moduloApp.esAdmin()||actual.html(ipage*busqueda.n+1+" al "+(ipage+1)*busqueda.n),"1"===actual.attr("data-noa")&&(actual.removeAttr("href"),actual.on("click",function(){var docHtml=document.getElementById(template).innerHTML,destino=$(target),postload=destino.attr("data-postload");destino.length>0&&(moduloActividad.on(),$.ajax({type:"PUT",url:"/paginar/",data:JSON.stringify({busqueda:busqueda,cursor:cursor}),contentType:"application/json; charset=utf-8"}).done(function(msg){var datos=msg.datos,sigui=msg.next;destino.empty();for(var i=0;i<datos.length;i++){var dato=datos[i],nuevo=$(docHtml);llenarTemplate(nuevo,dato),destino.append(nuevo)}if(void 0!==sigui&&sigui.length>0){var padrePaginacion=actual.closest(".paginacion");if(0==padrePaginacion.find("[data-next='"+sigui+"']").length){for(var padreLocal=actual.parent(),nombreTAG=padreLocal.prop("tagName"),cambio=!1;padreLocal.get(0)!=padrePaginacion.get(0)&&"BODY"!=nombreTAG;)cambio=!0,actual=padreLocal,padreLocal=padreLocal.parent(),nombreTAG=padreLocal.prop("tagName");var paginaSigui=actual.clone(),paginaSigui2;paginaSigui2=cambio?paginaSigui.find("[data-next]"):paginaSigui,paginaSigui2.attr("data-page",ipage+1),paginaSigui2.attr("data-next",sigui),padrePaginacion.append(paginaSigui),activatePageA(paginaSigui2)}}void 0!==postload&&eval(postload)}).fail(function(a,t){moduloMenus.mostrarMenuSoloTexto("Error paginando")}).always(function(){moduloActividad.off()}))}))}hayValor(nodo)||(nodo=$("body")),$.each(nodo.find("a[data-next]"),function(a,t){activatePageA($(t))})},funcElegirBorrar=function(){var a=$(".btnEliminar");a.length>0?a.remove():$("[about]").each(function(a,t){var o=$(t),e=o.find(".btnEliminar");if(0==e.length){o.prepend($('<div class="btnEliminar"><div class="btnEliminarX btnEliminar2 manito"></div></div>')),e=o.find(".btnEliminar");e.find(".btnEliminar2").click(function(){var a=moduloMenus.confirmar();$.when(a).then(function(){var a=o,t=a.attr("about"),e=null;e=a.attr("typeof");var n=(hayValor(e)?e:"")+"_"+t;n in mapaIds&&(t=mapaIds[n]),moduloActividad.on(),$.ajax({type:"DELETE",url:"/rest/"+(hayValor(e)?e:"")+"/"+t}).done(function(t){a.remove(),$("body").data("Midgard-midgardNotifications").create({body:JSON.stringify(t)}),location.reload()}).fail(function(a,t){$("body").data("Midgard-midgardNotifications").create({body:TRADUCTOR.error_ajax[LENGUAJE]})}).always(function(){moduloActividad.off()}),moduloMenus.sacarUltimo()},function(){moduloMenus.sacarUltimo()})})}}),"menu"===pila[pila.length-1]&&pila.pop()};return activarPaginacion(),{activarPaginacion:activarPaginacion,activarEdicion:activarEdicion,funcElegirBorrar:funcElegirBorrar}}();!function(a){function t(t){t.find("[styleProperty]").each(function(t,o){var e=a(o);if("ok"!==e.attr("act_style")){var n,r=e.attr("styleProperty");if(void 0===(n=void 0!==e.attr("about")?e:e.closest("[about]")))return;e.on("click",function(a){if(a.shiftKey){var t=e.attr("style");moduloMenus.mostrarFormularioEdicion(n.attr("about"),r,t)}else a.ctrlKey&&u(e,r)}),e.attr("act_style","ok")}})}function o(t){t.find("img[property]").each(function(t,o){var e=a(o);"ok"!==e.attr("act_img")&&(a(o).on("click",function(t){var e=a(o);t.altKey?c(e):u(e)}),e.attr("act_img","ok"))})}function e(t){t.find(".editable").each(function(t,o){var e=a(o);if("ok"!==e.attr("act_edt")&&(e.on("click",function(){var t=e.closest("[about]");if(t){if("none"===a("#midgardcreate-save").css("display"))return;moduloMenus.mostrarFormularioEdicion(t.attr("about"),e.attr("property"),e.html())}}),e.attr("act_edt","ok"),!e.hasClass("textarea_background"))){var n=a('<button type="button" style="padding: 5px !important;">editar</button>');n.bind("click",function(){e.click()}),e.after(n)}})}function n(t){t.find('[textplain="true"]').each(function(t,o){var e=a(o);"ok"!==e.attr("act_tpl")&&(e.on("blur",function(){e.html(e.text())}),e.attr("act_tpl","ok"))})}function r(t){t.find("[dateProperty]").each(function(t,o){var e=a(o),n=e.attr("dateProperty");if("ok"!==e.attr("act_date")){var r=e.closest("[about]");if(r){var d=formatearFecha(e,"dd/MM/yyyy"),l=a('<input style="display: none;" class="datepicker" type="text" autofocuss value="'+d+'" data-valuee="'+d+'"></input>');r.append(l),e.click(function(){l.click()});var c=a('<div style="display: none;" property="'+n+'">'+e.attr("data-value")+"</div>");r.append(c),l.on("change",function(){var t=n,o={},d="0";try{d=parseInt(toDate(l.val()).getTime()/1e3)}catch(a){}o[t]=d;var u=i.entities.get(r.attr("about"));u.set(o);var s=a("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(s,u)&&s.push(u),a("#midgardcreate-save").button({disabled:!1}),e.attr("data-value",d),c.text(d),formatearFecha(e)}),l.pickadate({format:"dd/mm/yyyy",formatSubmit:"dd/mm/yyyy",closeOnSelect:!0,closeOnClear:!0,selectMonths:!0,selectYears:!0})}e.attr("act_date","ok")}})}var i=getVieHere(),d=function(t,o,e,n,r){var i="[about='"+o+"'] [property='"+e+"']",d="[about='"+o+"'] [styleProperty='"+e+"'],[about='"+o+"'][styleProperty='"+e+"']";hayValor(r)||(r="");var l=function(){var i={};i[e+r]=n;var d=t.entities.get(o);d.set(i);var l=a("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(l,d)&&l.push(d),a("#midgardcreate-save").button({disabled:!1})},c=a(i),u=a(d);if(c.length>0){"IMG"==c.prop("tagName")&&("_alt"==r?c.attr("alt",n):c.attr("src",n)),l()}else u.length>0&&(n=n.replace(/"/g,"&quot;"),u.attr("style",n),l())};a("body").append(a('<input type=\'file\' id="formularioImagenes" class="fileEscondido" nodo2="" property2="" />')),a("body").append(a('<div class="formhtml invisible">\t<div class="ctrles"><a class="guardar">Guardar</a>&nbsp;<a class="cancelar">Cancelar</a></div>\t<div class="boxtexto">\t<textarea></textarea>\t</div></div>')),t(a("body"));var l=function(t,o){var e={ok:!1};return"none"===a("#midgardcreate-save").css("display")?e:(void 0!==t.attr("about")?e.padre=t:e.padre=t.closest("[about]"),void 0===e.padre?e:(e.ident=e.padre.attr("about"),hayValor(o)?e.propiedad=o:e.propiedad=t.attr("property"),void 0===e.ident||void 0===e.propiedad?e:(e.ok=!0,e)))},c=function(a){if("IMG"===a.prop("tagName")){var t=l(a);0!=t.ok&&moduloMenus.mostrarFormularioEdicion(t.ident,t.propiedad,a.attr("alt"),"_alt")}},u=function(t,o){var e=l(t,o);if(0!=e.ok){var n=/(background-image\s*:\s*url\s*\(\s*['"]?)([^'^"]*?)(\s*['"]?\))\s*(!\s*important)?\s*(;)?/gi,r=function(a){var e="http://storage.googleapis.com"+a+"?"+(new Date).getTime();if(hayValor(o)){var r=t.attr("style");return r=r.replace(n,""),r=r.trim(),hayValor(r)&&!r.endsWith(";")&&(r+=";"),r+="background-image: url('"+e+"') !important;",t.attr("style",r),r}return t.attr("src",e),e},c=512e3,u="/imagenesbasico";try{var s=t.attr("data-max");hayValor(s)&&(c=1024*parseInt(s))}catch(a){console.log("Intent� determinar tama�o m�ximo de imagen pero fall�")}var f=t.attr("data-carpeta");"undefined"!==(void 0===f?"undefined":_typeof(f))&&!1!==f&&(f=f.trim(),hayValor(f)&&("/"!=f.charAt(0)&&(f="/"+f),u+=f));var p=moduloArchivos.subirArchivo({dataFolder:u,id:function(){var a=/^(https?:\/\/storage\.googleapis\.com)([^\?]*)(\?.*)?$/gi,e=null;if(hayValor(o)){var r=t.attr("style"),i=n.exec(r);null!=i&&i.length>3&&(e=i[2])}else e=t.attr("src");if(!hayValor(e))return null;var d=a.exec(e);return null!=d&&d.length>=3?d[2]:null}(),maximoTamanio:c});a.when(p).then(function(a){var t=r(a.id);d(i,e.ident,e.propiedad,t)})}};o(a("body")),e(a("body")),n(a("body")),r(a("body")),a("body").bind("midgardeditableenable",function(i,d){var l=d.entity["@subject"],c=/(<)(.*)(>)/g,u=c.exec(l);u=u?u[2]:l;var s=a("[about='"+u+"']");void 0!==s&&(t(s),o(s),e(s),n(s),r(s))}),a("body").midgardCreate({url:function(){return"javascript:false;"},vie:i,highlight:!1,collectionWidgets:{default:"midgardCollectionAdd"}}),configureEditorsHere();a(".formhtml .cancelar").click(function(){a(".formhtml").addClass("invisible"),"formhtml"===pila[pila.length-1]&&pila.pop()}),a(".formhtml .guardar").click(function(){try{var t=a(".formhtml"),o=t.attr("nodo2"),e=t.attr("property2"),n=t.attr("sufijo"),r=a(".formhtml textarea").val();d(i,o,e,r,n),a(".formhtml").addClass("invisible"),"formhtml"===pila[pila.length-1]&&pila.pop()}catch(t){a("body").data("Midgard-midgardNotifications").create({body:"Error "+t})}}),a("#formularioImagenes").change(function(){if(this.files&&this.files[0]){var t=new FileReader;t.onload=function(t){var o=a("#formularioImagenes"),e=o.attr("nodo2"),n=o.attr("property2"),r=a("[about='"+e+"'] [property='"+n+"']"),d={};if(d[n]=t.target.result,r){"IMG"==r.prop("tagName")?r.attr("src",t.target.result):r.attr("style","background-image: url('"+t.target.result+"') !important");var l=i.entities.get(e);l.set(d);var c=a("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(c,l)&&c.push(l),a("#midgardcreate-save").button({disabled:!1})}},t.readAsDataURL(this.files[0])}}),a("textarea[property]").on("change keyup paste",function(){self=a(this);var t=self.attr("property"),o=self.closest("[about]");if(o){var e=o.attr("about"),n=self.val(),r={};r[t]=n;var d=i.entities.get(e);d.set(r);var l=a("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(l,d)&&l.push(d),a("#midgardcreate-save").button({disabled:!1})}})}(jQuery);