var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},actividad=function(){var t=0;return{on:function(){0==t&&$("body").append('<div id="loading"><p>Procesando petici&oacute;n...</p></div>'),t++},off:function(){--t<=0&&(t=0,$("#loading").remove())}}}(),manejoPopUps=function(){return{mostrarMenuPagina:function(){pila.push("menu_pagina"),$(".menu_core").toggleClass("invisible"),$(".menu_pagina").toggleClass("invisible"),window.scrollTo(0,0)}}}();!function(t){function a(a){a.find("[styleProperty]").each(function(a,e){var r=t(e);if("ok"!==r.attr("act_style")){var o,i=r.attr("styleProperty");if(void 0===(o=void 0!==r.attr("about")?r:r.closest("[about]")))return;var n=t('<textarea style="display: none;" property="'+i+'" class="editable"></textarea>');n.text(r.attr("style")),o.append(n),n.change(function(){var t=n.val();t=t.replace(/"/g,"&quot;"),r.attr("style",t)}),r.on("click",function(t){t.shiftKey?n.click():t.ctrlKey&&p(r,i)}),r.attr("act_style","ok")}})}function e(a){a.find("img[property]").each(function(a,e){var r=t(e);"ok"!==r.attr("act_img")&&(t(e).on("click",function(a){var r=t(e);a.altKey?c(r):p(r)}),r.attr("act_img","ok"))})}function r(a){a.find(".editable").each(function(a,e){var r=t(e);if("ok"!==r.attr("act_edt")&&(r.on("click",function(){var a=r.closest("[about]");if(a){if("none"===t("#midgardcreate-save").css("display"))return;t(".formhtml").attr("nodo2",a.attr("about")),t(".formhtml").attr("property2",r.attr("property")),t(".formhtml textarea").val(r.html()),t(".formhtml").removeClass("invisible"),pila.push("formhtml")}}),r.attr("act_edt","ok"),!r.hasClass("textarea_background"))){var o=t('<button type="button" style="padding: 5px !important;">editar</button>');o.bind("click",function(){r.click()}),r.after(o)}})}function o(a){a.find('[textplain="true"]').each(function(a,e){var r=t(e);"ok"!==r.attr("act_tpl")&&(r.on("blur",function(){r.html(r.text())}),r.attr("act_tpl","ok"))})}function i(a){a.find("[dateProperty]").each(function(a,e){var r=t(e),o=r.attr("dateProperty");if("ok"!==r.attr("act_date")){var i=r.closest("[about]");if(i){var d=formatearFecha(r,"dd/MM/yyyy"),l=t('<input style="display: none;" class="datepicker" type="text" autofocuss value="'+d+'" data-valuee="'+d+'"></input>');i.append(l),r.click(function(){l.click()});var s=t('<div style="display: none;" property="'+o+'">'+r.attr("data-value")+"</div>");i.append(s),l.on("change",function(){var a=o,e={},d="0";try{d=parseInt(toDate(l.val()).getTime()/1e3)}catch(t){}e[a]=d;var c=n.entities.get(i.attr("about"));c.set(e);var p=t("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(p,c)&&p.push(c),t("#midgardcreate-save").button({disabled:!1}),r.attr("data-value",d),s.text(d),formatearFecha(r)}),l.pickadate({format:"dd/mm/yyyy",formatSubmit:"dd/mm/yyyy",closeOnSelect:!0,closeOnClear:!0,selectMonths:!0,selectYears:!0})}r.attr("act_date","ok")}})}var n=getVieHere(),d=function(t){return void 0!=t&&null!=t&&(!("string"==typeof t)||t.trim().length>0)},l=function(a,e,r,o,i){var n="[about='"+e+"'] [property='"+r+"']",l="[about='"+e+"'] [styleProperty='"+r+"']";d(i)||(i="");var s=t(n),c=t(l);if(s.length>0){var p=s.prop("tagName");"IMG"==p?"_alt"==i?s.attr("alt",o):s.attr("src",o):"TEXTAREA"==p?(c.length>0&&(o=o.replace(/"/g,"&quot;")),s.text(o),s.change()):s.html(o);var u={};u[r+i]=o;var f=a.entities.get(e);f.set(u);var m=t("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(m,f)&&m.push(f),t("#midgardcreate-save").button({disabled:!1})}};t("body").append(t('<input type=\'file\' id="formularioImagenes" class="fileEscondido" nodo2="" property2="" />')),t("body").append(t('<div class="formhtml invisible">\t<div class="ctrles"><a class="guardar">Guardar</a>&nbsp;<a class="cancelar">Cancelar</a></div>\t<div class="boxtexto">\t<textarea></textarea>\t</div></div>')),a(t("body"));var s=function(a,e){var r={ok:!1};return"none"===t("#midgardcreate-save").css("display")?r:(void 0!==a.attr("about")?r.padre=a:r.padre=a.closest("[about]"),void 0===r.padre?r:(r.ident=r.padre.attr("about"),d(e)?r.propiedad=e:r.propiedad=a.attr("property"),void 0===r.ident||void 0===r.propiedad?r:(r.ok=!0,r)))},c=function(a){if("IMG"===a.prop("tagName")){var e=s(a);0!=e.ok&&(t(".formhtml").attr("nodo2",e.ident),t(".formhtml").attr("property2",e.propiedad),t(".formhtml").attr("sufijo","_alt"),t(".formhtml textarea").val(a.attr("alt")),t(".formhtml").removeClass("invisible"),pila.push("formhtml"))}},p=function(a,e){var r=s(a,e);if(0!=r.ok){var o=/(background-image\s*:\s*url\s*\(\s*['"]?)([^'^"]*?)(\s*['"]?\))\s*(!\s*important)?\s*(;)?/gi,i=function(t){var r="http://storage.googleapis.com"+t+"?"+(new Date).getTime();if(d(e)){var i=a.attr("style");return i=i.replace(o,""),i=i.trim(),d(i)&&!i.endsWith(";")&&(i+=";"),i+="background-image: url('"+r+"') !important;",a.attr("style",i),i}return a.attr("src",r),r},c=function(){var t=/^(https?:\/\/storage\.googleapis\.com)([^\?]*)(\?.*)?$/gi,r=null;if(d(e)){var i=a.attr("style"),n=o.exec(i);null!=n&&n.length>3&&(r=n[2])}else r=a.attr("src");if(!d(r))return null;var l=t.exec(r);return null!=l&&l.length>=3?l[2]:null},p=512e3,u="/imagenesbasico";try{var f=a.attr("data-max");d(f)&&(p=1024*parseInt(f))}catch(t){console.log("Intent� determinar tama�o m�ximo de imagen pero fall�")}var m=a.attr("data-carpeta");"undefined"!==(void 0===m?"undefined":_typeof(m))&&!1!==m&&(m=m.trim(),d(m)&&("/"!=m.charAt(0)&&(m="/"+m),u+=m));var v=t('<input type="file" class="invisible" accept="image/*">');v.on("change",function(a){var e=a.target.files[0];if(e.size>p)return void alert("Archivo muy grande! debe ser menor a "+p/1024+"KB");(new FileReader).readAsDataURL(e);var o=new FormData;o.append("file-0",e),o.append("folder",u);var s=c();d(s)&&o.append("name",s),actividad.on(),t.ajax({url:"/storage/",type:"POST",data:o,headers:{"X-CSRFToken":t('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(t){if(0!=t.error)alert("Error subiendo la imagen");else{var a=i(t.id);l(n,r.ident,r.propiedad,a)}}).fail(function(){alert("Error cargando imagen")}).always(function(){actividad.off()})}),v.click()}};e(t("body")),r(t("body")),o(t("body")),i(t("body")),t("body").bind("midgardeditableenable",function(n,d){var l=d.entity["@subject"],s=/(<)(.*)(>)/g,c=s.exec(l);c=c?c[2]:l;var p=t("[about='"+c+"']");void 0!==p&&(a(p),e(p),r(p),o(p),i(p))}),t("body").midgardCreate({url:function(){return"javascript:false;"},vie:n,highlight:!1,collectionWidgets:{default:"midgardCollectionAdd"}}),configureEditorsHere();t(".formhtml .cancelar").click(function(){t(".formhtml").addClass("invisible"),"formhtml"===pila[pila.length-1]&&pila.pop()}),t(".formhtml .guardar").click(function(){try{var a=t(".formhtml"),e=a.attr("nodo2"),r=a.attr("property2"),o=a.attr("sufijo"),i=t(".formhtml textarea").val();l(n,e,r,i,o),t(".formhtml").addClass("invisible"),"formhtml"===pila[pila.length-1]&&pila.pop()}catch(a){t("body").data("Midgard-midgardNotifications").create({body:"Error "+a})}}),t("#formularioImagenes").change(function(){if(this.files&&this.files[0]){var a=new FileReader;a.onload=function(a){var e=t("#formularioImagenes"),r=e.attr("nodo2"),o=e.attr("property2"),i=t("[about='"+r+"'] [property='"+o+"']"),d={};if(d[o]=a.target.result,i){"IMG"==i.prop("tagName")?i.attr("src",a.target.result):i.attr("style","background-image: url('"+a.target.result+"') !important");var l=n.entities.get(r);l.set(d);var s=t("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(s,l)&&s.push(l),t("#midgardcreate-save").button({disabled:!1})}},a.readAsDataURL(this.files[0])}}),t("textarea[property]").on("change keyup paste",function(){self=t(this);var a=self.attr("property"),e=self.closest("[about]");if(e){var r=e.attr("about"),o=self.val(),i={};i[a]=o;var d=n.entities.get(r);d.set(i);var l=t("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(l,d)&&l.push(d),t("#midgardcreate-save").button({disabled:!1})}})}(jQuery);