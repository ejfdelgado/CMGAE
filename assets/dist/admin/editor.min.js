var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hayValor=function(e){return void 0!=e&&null!=e&&(!("string"==typeof e)||e.trim().length>0)},esFuncion=function(e){return"function"==typeof e},esNumero=function(e){return"number"==typeof e||/^\d+$/.test(e)},esBoolean=function(e){return"boolean"==typeof e},esObjeto=function(e){return"object"==(void 0===e?"undefined":_typeof(e))&&null!==e},esLista=function(e){return hayValor(e)&&e instanceof Array},esMultilenguaje=function(e){return/^(\S)+(\.\S+)+$/gim.test(e)},leerObj=function(e,a,o,t){if(!hayValor(a)||!esObjeto(e))return o;for(var n=a.split("."),r=e,i=0;i<n.length;i++){var c=n[i];if(esNumero(c)&&esLista(r)&&(c=parseInt(c)),r=r[c],i!=n.length-1&&!esObjeto(r))return o}return hayValor(r)?!0!==t&&esFuncion(r)?r():r:o},asignarObj=function(e,a,o){for(var t=a.split("."),n=e,r=0;r<t.length;r++){var i=t[r];esNumero(i)&&(i=parseInt(i)),esObjeto(n)&&(r==t.length-1?esLista(n[i])&&esLista(o)&&n[i]!==o?(n[i].splice(0,n[i].length),$.each(o,function(e,a){n[i].push(a)})):n[i]=o:((Object.keys(n).indexOf(""+i)<0||null==n[i])&&(esNumero(t[r+1])?n[i]=[]:n[i]={}),n=n[i]))}},darRutasObjeto=function(e,a){var o=[];return function e(t,n){esObjeto(t)?$.each(t,function(t,r){var i=null;i=null===n?t:n+"."+t,esFuncion(a)&&a(r)&&o.push(i),e(r,i)}):null!==n&&(esFuncion(a)?a(t)&&o.push(n):o.push(n))}(e,null),o},predefinir=function(e,a){for(var o=darRutasObjeto(a),t=0;t<o.length;t++){var n=o[t];if(!hayValor(leerObj(e,n,null,!0))){var r=leerObj(a,n,null,!0);asignarObj(e,n,r)}}return e},configurarListasEditor=function(e,a){e.use(new e.RdfaService);for(var o in a){for(var t=o+"Rel",n=a[o],r=[],i=0;i<n.campos.length;i++){var c=n.campos[i];r.push({id:c.nombre,range:c.tipo,min:0,max:1})}e.types.add(o,r);for(var d=0;d<n.listas.length;d++){var u=n.listas[d];e.types.add(u.nombre,[{id:t,range:o,min:0,max:-1}])}e.service("rdfa").setTemplate(o,t,jQuery(n.ejemplo).html())}},tieneAtributo=function(e,a){var o=e.attr(a);return"undefined"!==(void 0===o?"undefined":_typeof(o))&&!1!==o},activarConteoRegresivo=function(){$(".mycountdown").each(function(e,a){var o=$(a),t=o.text(),n=o.attr("data-count-format");o.countdown(t,function(e){$(this).text(e.strftime(n))})})};if(!hayValor(moduloActividad))var moduloActividad=function(){var e=0;return{on:function(a){if(hayValor(a)||(a=""),0==e){var o=$('<div id="loading"><p></p></div>');o.find("p").html(a),$("body").append(o)}e++},off:function(){--e<=0&&(e=0,$("#loading").remove())}}}();if(!hayValor(moduloHttp))var moduloHttp=function(){return{get:function(e){var a=$.Deferred();return moduloActividad.on(),$.ajax({url:e,type:"GET",cache:!1}).done(function(e){a.resolve(e)}).fail(function(){a.reject()}).always(function(){moduloActividad.off()}),a.promise()}}}();if(!hayValor(moduloLocal))var moduloLocal=function(){var e={lengua:LENGUAJE,lenguapred:LENGUAJE_PRED},a=null,o=function(e){return esObjeto(a)?leerObj(a,e,e):e},t=function(e){$.each(e.find(".traducir"),function(e,a){var t=$(a),n=t.text();if(esMultilenguaje(n)){var r=o(n);r!=n&&t.html(r)}})},n=function(e,a){var o=e.attr("data-value");if(o){var t=new Date(0);try{t.setUTCSeconds(parseInt(o))}catch(e){}if(e.find("[data-format]").each(function(e,a){var o=$(a),n=o.attr("data-format"),r=$.format.date(t.getTime(),n);o.text(r)}),void 0!==a)return $.format.date(t.getTime(),a)}return""},r=function(e){e.find("[dateProperty]").each(function(e,a){var o=$(a);n(o)})},i=function(){$("[data-lenguaje]").each(function(a,o){var t=$(o),n=t.attr("data-lenguaje");t.off("click","**"),t.on("click",function(){var a=/(http)(s?)(:)(\/\/)(.*?)(\/)((leng-)(.*?)(\/))?(.*)/g.exec(window.location);if(a){for(var o="",t=!0,r=a[9],i=n===e.lenguapred,c=1;c<a.length;c++){var d=a[c];if(c<=6||c>=11)void 0!==d&&(o+=d);else{if(i){if(void 0===r)return}else if(r===n)return;!i&&t&&(o+="leng-"+n+"/",t=!1)}}window.location=o}})})};return function(){var o=moduloHttp.get("/assets/cmgae/local/"+e.lengua+".json");$.when(o).then(function(e){a=JSON.parse(e)}),r($("body")),i()}(),{traducir:o,procesarElemento:t,epochAFechaElem:r}}();if(!hayValor(moduloMenus))var moduloMenus=function(){var e=[],a=function(e){return moduloHttp.get("/assets/cmgae/menus"+e)},o=function(a){return 0!=e.length&&e[e.length-1].id==a},t=function(){if(0!=e.length){e[e.length-1].nodo.remove(),e.pop()}},n=function(e){var o=a("/soloTexto.html");$.when(o).then(function(a){u("alerta",a,{html:{".mensaje_texto":e}})})},r=function(){n(moduloLocal.traducir("menus.mensajes.error"))},i=function(e){$.when(e).then(function(){n(moduloLocal.traducir("menus.mensajes.hecho"))},r)},c=function(e,a){moduloLocal.procesarElemento(e);var o={funciones:{".menu_opc_ingresar":moduloApp.login,".menu_opc_salir":moduloApp.logout,".menu_opc_borrar_cache":moduloApp.borrarCache,".create-ui-toggle2":moduloApp.abrirBarraEdicion,".menuEliminar":moduloEdicion.funcElegirBorrar},html:{},botones:{}};if(o=$.extend(o,a),$.each(o.funciones,function(a,o){e.find(a).on("click",function(){t();var e=o();hayValor(e)&&i(e)})}),esObjeto(o.botones)){var n=$('<div class="row"><div class="col-xs-12"><div class="text-right botones-aca"></div></div></div>'),r={texto:"?",clase:"btn-primary",accion:function(){}};$.each(o.botones,function(e,a){predefinir(a,r);var o=$('<button type="button" class="btn btn-xs"></button>');o.on("click",a.accion),o.addClass(a.clase),o.text(a.texto),n.find(".botones-aca").append(o)}),e.append(n)}for(var c in o.html)e.find(c).html(o.html[c])},d=function(){var e=a("/confirmar.html"),o=$.Deferred();return $.when(e).then(function(e){var a={botones:{aceptar:{texto:moduloLocal.traducir("menus.botones.aceptar"),clase:"btn-success",accion:function(){o.resolve()}},cancelar:{texto:moduloLocal.traducir("menus.botones.cancelar"),clase:"btn-danger",accion:function(){o.reject()}}}};u("confirmacion",e,a)}),o.promise()},u=function(a,o,t){var n=$(o);$("body").append(n),e.push({id:a,nodo:n}),c(n,t)},l=function(){var e=$.Deferred();if(o("menu"))return t(),e.reject(),e.promise();var n=null;return n=a(moduloApp.esUsuario()?moduloApp.esAdmin()?"/menuInicialAdmin.html":"/menuInicialAnonimo.html":"/menuInicialAnonimo.html"),$.when(n).then(function(a){u("menu",a),e.resolve()}),e.promise()},s=function(){pila.push("menu_pagina"),$(".menu_core").toggleClass("invisible"),$(".menu_pagina").toggleClass("invisible"),window.scrollTo(0,0)},f=function(e,a,o,t){pila.push("formhtml"),$(".formhtml").attr("nodo2",e),$(".formhtml").attr("property2",a),$(".formhtml").attr("sufijo",t),$(".formhtml textarea").val(o),$(".formhtml").removeClass("invisible")};return $(document).keyup(function(a){27==a.keyCode&&(0==e.length?l():t())}),{mostrarMenuPagina:s,mostrarFormularioEdicion:f,mostrarMenuBasico:l,mostrarMenuSoloTexto:n,confirmar:d,sacarUltimo:t,error:r}}();if(!hayValor(moduloApp))var moduloApp=function(){var e={URL_LOGIN:URL_LOGIN,URL_LOGOUT:URL_LOGOUT,HAS_USER:HAS_USER,IS_ADMIN:IS_ADMIN},a=function(){return e.IS_ADMIN},o=function(){return e.HAS_USER},t=function(){moduloActividad.on(),window.location.href=e.URL_LOGIN},n=function(){moduloActividad.on(),window.location.href=e.URL_LOGOUT},r=function(){"full"===$("body").data("Midgard-midgardToolbar").options.display?($("body").data("Midgard-midgardToolbar").__proto__.hide(),$("body").data("Midgard-midgardToolbar").options.display="minimized"):($("body").data("Midgard-midgardToolbar").__proto__.show(),$("body").data("Midgard-midgardToolbar").options.display="full")};return{esAdmin:a,esUsuario:o,login:t,logout:n,borrarCache:function(){var e=$.Deferred();return moduloActividad.on(),$.ajax({type:"GET",url:"/act/clearmemcache",data:JSON.stringify({}),contentType:"application/json; charset=utf-8"}).done(function(a){e.resolve()}).fail(function(a,o){e.reject()}).always(function(){moduloActividad.off()}),e.promise()},abrirBarraEdicion:r}}();if(!hayValor(moduloArchivos))var moduloArchivos=function(){var e=function(e){var a={maximoTamanio:512e3,tipos:"image/*",auto:"true",dataFolder:"/imagenesbasico"};for(var o in a)hayValor(e[o])||(e[o]=a[o]);return e},a=function(a){var o=$.Deferred();a=e(a);var t=$('<input type="file" class="invisible" accept="'+a.tipos+'">');return t.on("change",function(e){var t=e.target.files[0];if(t.size>a.maximoTamanio)return alert("Archivo muy grande! debe ser menor a "+a.maximoTamanio/1024+" KB"),void o.reject();(new FileReader).readAsDataURL(t);var n=new FormData;n.append("file-0",t),n.append("folder",a.dataFolder),hayValor(a.id)&&n.append("name",a.id),"false"==a.auto&&n.append("auto","false"),moduloActividad.on(),$.ajax({url:"/storage/",type:"POST",data:n,headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(e){0!=e.error?o.reject():o.resolve(e)}).fail(function(){o.reject()}).always(function(){moduloActividad.off()})}),t.click(),o.promise()},o=function(e,a){var o=$.Deferred(),t={type:"text/plain"},n=new File([a],e,t),r=new FormData;return r.append("file-0",n),r.append("auto","false"),r.append("name",e),moduloActividad.on(),$.ajax({url:"/storage/",type:"POST",data:r,headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(e){0!=e.error?o.reject():o.resolve()}).fail(function(){o.reject()}).always(function(){moduloActividad.off()}),o.promise()};return{leerTextoPlano:function(e){var a=$.Deferred();return moduloActividad.on(),$.ajax({url:"/storage/read?name="+encodeURIComponent(e),type:"GET",cache:!1,contentType:!1,processData:!1}).done(function(e){a.resolve(e)}).fail(function(){a.reject()}).always(function(){moduloActividad.off()}),a.promise()},escribirTextoPlano:o,subirArchivo:a}}();if(!hayValor(moduloEditorTexto))var moduloEditorTexto=function(e){var a=function(){e.empty();var a=$("<div/>",{id:"pluginEditor"});e.append(a)},o=function(e){var a=ace.edit("pluginEditor"),o=moduloArchivos.escribirTextoPlano(e,a.getValue());$.when(o).then(function(){alert("Archivo guardado!")},function(){alert("Error subiendo el archivo")})};return{abrirEditor:function(e,t,n){var r=[{patron:/.*\.js/gi,editor:"ace/mode/javascript"},{patron:/.*\.html/gi,editor:"ace/mode/html"},{patron:/.*\.json/gi,editor:"ace/mode/json"},{patron:/.*\.css/gi,editor:"ace/mode/css"},{patron:/.*\.xml/gi,editor:"ace/mode/xml"}];a();var i=ace.edit("pluginEditor");i.setValue(t),i.setTheme("ace/theme/monokai"),i.commands.addCommand({name:"comandoGuardar",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(e){o(n)},readOnly:!0});for(var c=0;c<r.length;c++){var d=r[c];d.patron.test(e)&&i.getSession().setMode(d.editor)}},destruirEditor:a}};if(!hayValor(moduloArbolArchivos))var moduloArbolArchivos=function(e,a){var o=moduloEditorTexto(a);e.on("changed.jstree",function(e,a){if(a.selected.length){a.instance.get_node(a.selected[0])}}),e.on("rename_node.jstree",function(e,a){var o=(a.old,a.text),t=a.node;"folder"==t.original.type?a.instance.set_id(t,a.node.parent+o+"/"):a.instance.set_id(t,a.node.parent+o)}),e.on("load_node.jstree",function(e,a){for(var o=a.instance,n=0;n<a.node.children.length;n++){var r=a.node.children[n],i=o.get_node(r);t(i)}}),e.on("create_node.jstree",function(e,a){t(a.node)});var t=function(a){"file"==a.original.type&&e.jstree(!0).set_icon(a.id,"/assets/js/jstree/themes/default/file.png")},n=function(e){var a={separator_before:!1,separator_after:!1,label:"Abrir",action:function(e){o.destruirEditor();var a=$.jstree.reference(e.reference),t=a.get_node(e.reference),n=moduloArchivos.leerTextoPlano(t.id);$.when(n).then(function(e){"string"!=typeof e&&(e=""),o.abrirEditor(t.text,e,t.id)})}},t={separator_before:!1,separator_after:!1,label:"Crear carpeta",action:function(e){var a={text:"nuevo",type:"folder"},o=$.jstree.reference(e.reference),t=o.get_node(e.reference);o.create_node(t,a,"last",function(e){setTimeout(function(){o.edit(e)},0)})}},n={separator_before:!1,separator_after:!1,label:"Crear archivo",action:function(e){var a={text:"nuevo",type:"file"},o=$.jstree.reference(e.reference),t=o.get_node(e.reference);o.create_node(t,a,"last",function(e){setTimeout(function(){o.edit(e)},0)})}},r={separator_before:!1,separator_after:!1,label:"Renombrar",action:function(a){$.jstree.reference(a.reference).edit(e)}},i={separator_before:!1,separator_after:!1,label:"Borrar",action:function(a){$.jstree.reference(a.reference).delete_node(e)}};return"folder"==e.original.type?{CrearArchivo:n,CrearCarpeta:t,Borrar:i}:"file"==e.original.type?{Abrir:a,Renombrar:r,Borrar:i}:void 0};return e.jstree({core:{check_callback:!0,themes:{stripes:!0},data:{url:function(e){return"/storage/jstreelist"},dataType:"json",data:function(e){return{id:e.id}}}},contextmenu:{items:n},plugins:["contextmenu","dnd","search","json_data","state","wholerow"]}),{}};if(!hayValor(moduloEdicion))var moduloEdicion=function(){var mapaIds={},activarEdicionOk=!1,activarEdicion=function(){1!=activarEdicionOk&&"undefined"!=typeof Backbone&&(Backbone.sync=function(e,a,o){try{var t=a.toJSON(),n=t["@subject"];a.isNew()&&(n in mapaIds?t["@subject"]=mapaIds[n]:(t["@subject"]="<"+(new Date).getTime()+"_"+Math.floor(10*Math.random()+1)+">",mapaIds[n]=t["@subject"]));var r=t["@subject"],i=t["@type"],c=/(viejs\.org\/ns\/)(.*)(>)/g.exec(i),d=null;c&&(d=c[2]);var u=/(<)(.*)(>)/g,l=u.exec(r);if(null==l)return void o.error("error: no es identificador "+r);var s=l[2],f={};for(var p in t){var c=/(viejs\.org\/ns\/)(.*)(>)/g.exec(p);c&&(f[c[2]]=t[p])}var m={};switch(m.payload=f,m.leng=LENGUAJE,e){case"create":case"update":moduloActividad.on(),$.ajax({type:"PUT",url:"/rest/"+(null===d||void 0===d?"Documento":d)+"/"+s,data:JSON.stringify(m),contentType:"application/json; charset=utf-8"}).done(function(e){o.success(a)}).fail(function(e,a){o.error("error")}).always(function(){moduloActividad.off()})}}catch(e){o.error("error "+e)}},activarEdicionOk=!0)},activarPaginacion=function activarPaginacion(nodo){function activatePageA(actual){var cursor=actual.attr("data-next"),busqueda=JSON.parse(actual.attr("data-q")),template=actual.attr("data-tpl"),target=actual.attr("data-target"),ipage=parseInt(actual.attr("data-page"));busqueda.n||(busqueda.n=100),moduloApp.esAdmin()||actual.html(ipage*busqueda.n+1+" al "+(ipage+1)*busqueda.n),"1"===actual.attr("data-noa")&&(actual.removeAttr("href"),actual.on("click",function(){var docHtml=document.getElementById(template).innerHTML,destino=$(target),postload=destino.attr("data-postload");destino.length>0&&(moduloActividad.on(),$.ajax({type:"PUT",url:"/paginar/",data:JSON.stringify({busqueda:busqueda,cursor:cursor}),contentType:"application/json; charset=utf-8"}).done(function(msg){var datos=msg.datos,sigui=msg.next;destino.empty();for(var i=0;i<datos.length;i++){var dato=datos[i],nuevo=$(docHtml);llenarTemplate(nuevo,dato),destino.append(nuevo)}if(void 0!==sigui&&sigui.length>0){var padrePaginacion=actual.closest(".paginacion");if(0==padrePaginacion.find("[data-next='"+sigui+"']").length){for(var padreLocal=actual.parent(),nombreTAG=padreLocal.prop("tagName"),cambio=!1;padreLocal.get(0)!=padrePaginacion.get(0)&&"BODY"!=nombreTAG;)cambio=!0,actual=padreLocal,padreLocal=padreLocal.parent(),nombreTAG=padreLocal.prop("tagName");var paginaSigui=actual.clone(),paginaSigui2;paginaSigui2=cambio?paginaSigui.find("[data-next]"):paginaSigui,paginaSigui2.attr("data-page",ipage+1),paginaSigui2.attr("data-next",sigui),padrePaginacion.append(paginaSigui),activatePageA(paginaSigui2)}}void 0!==postload&&eval(postload)}).fail(function(e,a){moduloMenus.mostrarMenuSoloTexto("Error paginando")}).always(function(){moduloActividad.off()}))}))}hayValor(nodo)||(nodo=$("body")),$.each(nodo.find("a[data-next]"),function(e,a){activatePageA($(a))})},funcElegirBorrar=function(){var e=$(".btnEliminar");e.length>0?e.remove():$("[about]").each(function(e,a){var o=$(a),t=o.find(".btnEliminar");if(0==t.length){o.prepend($('<div class="btnEliminar"><div class="btnEliminarX btnEliminar2 manito"></div></div>')),t=o.find(".btnEliminar");t.find(".btnEliminar2").click(function(){var e=moduloMenus.confirmar();$.when(e).then(function(){var e=o,a=e.attr("about"),t=null;t=e.attr("typeof");var n=(hayValor(t)?t:"")+"_"+a;n in mapaIds&&(a=mapaIds[n]),moduloActividad.on(),$.ajax({type:"DELETE",url:"/rest/"+(hayValor(t)?t:"")+"/"+a}).done(function(a){e.remove(),$("body").data("Midgard-midgardNotifications").create({body:JSON.stringify(a)}),location.reload()}).fail(function(e,a){$("body").data("Midgard-midgardNotifications").create({body:TRADUCTOR.error_ajax[LENGUAJE]})}).always(function(){moduloActividad.off()}),moduloMenus.sacarUltimo()},function(){moduloMenus.sacarUltimo()})})}}),"menu"===pila[pila.length-1]&&pila.pop()};return activarPaginacion(),{activarPaginacion:activarPaginacion,activarEdicion:activarEdicion,funcElegirBorrar:funcElegirBorrar}}();if(!hayValor(moduloContactenos))var moduloContactenos=function(){function e(e,a,o){var t="div",n=e.prop("tagName");"UL"!=n&&"OL"!=n||(t="li");var r=$("<"+t+' property="'+o+'" class="'+o+'"></'+t+">");r.text(a),e.prepend(r)}function a(e){var a=e.attr("validacion"),o=e.attr("placeholder");if(void 0===o&&(o=e.attr("name")),void 0!==a){void 0===o&&(o=a);var t=new RegExp(a,"gi");if(!e.val().match(t))return{error:1,msg:moduloLocal.traducir("general.verifique")+o}}return{error:0}}function o(e,a){e.find("input[type=text],select,textarea").each(function(e,o){var t=$(o),n=t.attr("name");void 0===n&&(n=t.attr("placeholder")),n in a&&t.val(a[n])}),e.find("input[type=checkbox]").each(function(e,o){var t=$(o),n=t.attr("name");void 0===n&&(n=t.attr("placeholder")),n in a&&(1==a[n]?t.prop("checked",!0):t.prop("checked",!1))}),e.find("input[type=radio]").each(function(e,o){var t=$(o),n=t.attr("name");void 0===n&&(n=t.attr("placeholder")),n in a&&(a[n]==t.attr("value")?t.prop("checked",!0):t.prop("checked",!1))})}function t(e,o){var t=[];return e.find("input[type=text],textarea").each(function(e,o){var n=$(o),r=a(n);t.push(r)}),e.find("input[type=text],select,textarea,input[type=radio]:checked").each(function(e,a){var t=$(a),n=t.attr("name");if(void 0===n&&(n=t.attr("placeholder")),void 0!==n){var r=t.val();o[n]=r}}),e.find("input[type=checkbox]").each(function(e,a){var t=$(a),n=t.attr("name");if(void 0===n&&(n=t.attr("placeholder")),void 0!==n){var r=t.is(":checked")?1:0;o[n]=r}}),t}return function(){$(".contenedor-envio-mensajes[data-preload]").each(function(e,a){var t=$(this),n=t.attr("data-preload");void 0!==n&&0!=n.length&&$.ajax({type:"GET",url:n,contentType:"application/json; charset=utf-8"}).done(function(e){o(t,e)}).fail(function(e,a){moduloMenus.error()})}),$(".boton-envio-mensaje").on("click",function(){moduloActividad.on();var a=$(this),o=a.attr("data-url");void 0!==o&&0!=o.length||(o="/act/correo");var n=a.attr("data-once");n=void 0===n||0==n.length;var r=a.closest(".contenedor-envio-mensajes");if(r){r.find("[property='error']").remove(),r.find('[property="gracias"]').addClass("invisible");for(var i={},c=t(r,i),d=0,u=0;u<c.length;u++){var l=c[u];0!=l.error&&(e(r,l.msg,"error"),d++)}if(d>0)return void moduloActividad.off();$.ajax({type:"PUT",url:o,data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(a){0==a.error?(n&&r.children().addClass("invisible"),r.find('[property="gracias"]').removeClass("invisible")):e(r,a.msg,"error"),moduloActividad.off()}).fail(function(a,o){e(r,o,"error"),moduloActividad.off()})}})}(),{}};$(function(){$("#paginaCompleta").enhsplitter({minSize:60,vertical:!1,position:60}),$("#totalArchivos").enhsplitter({minSize:60,position:350}),moduloArbolArchivos($("#contenedorArchivos"),$("editorTexto"))});