var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hayValor=function(e){return void 0!=e&&null!=e&&(!("string"==typeof e)||e.trim().length>0)},esFuncion=function(e){return"function"==typeof e},esNumero=function(e){return"number"==typeof e||/^\d+$/.test(e)},esBoolean=function(e){return"boolean"==typeof e},esObjeto=function(e){return"object"==(void 0===e?"undefined":_typeof(e))&&null!==e},esLista=function(e){return hayValor(e)&&e instanceof Array},esMultilenguaje=function(e){return/^(\S)+(\.\S+)+$/gim.test(e)},leerObj=function(e,a,o){if(!hayValor(a)||!esObjeto(e))return o;for(var n=a.split("."),t=e,r=0;r<n.length;r++){var i=n[r];if(esNumero(i)&&esLista(t)&&(i=parseInt(i)),t=t[i],r!=n.length-1&&!esObjeto(t))return o}return hayValor(t)?esFuncion(t)?t():t:o};if(!hayValor(moduloActividad))var moduloActividad=function(){var e=0;return{on:function(a){if(hayValor(a)||(a=""),0==e){var o=$('<div id="loading"><p></p></div>');o.find("p").html(a),$("body").append(o)}e++},off:function(){--e<=0&&(e=0,$("#loading").remove())}}}();if(!hayValor(moduloHttp))var moduloHttp=function(){return{get:function(e){var a=$.Deferred();return moduloActividad.on(),$.ajax({url:e,type:"GET",cache:!1}).done(function(e){a.resolve(e)}).fail(function(){a.reject()}).always(function(){moduloActividad.off()}),a.promise()}}}();if(!hayValor(moduloLocal))var moduloLocal=function(){var e={lengua:LENGUAJE},a=null,o=function(e){return esObjeto(a)?leerObj(a,e,e):e},n=function(e){$.each(e.find(".traducir"),function(e,a){var n=$(a),t=n.text();if(esMultilenguaje(t)){var r=o(t);r!=t&&n.html(r)}})};return function(){var o=moduloHttp.get("/assets/cmgae/local/"+e.lengua+".json");$.when(o).then(function(e){a=JSON.parse(e)})}(),{traducir:o,procesarElemento:n}}();if(!hayValor(moduloMenus))var moduloMenus=function(){var e=[],a=function(e){return moduloHttp.get("/assets/cmgae/menus"+e)},o=function(a){return 0!=e.length&&e[e.length-1].id==a},n=function(){if(0!=e.length){e[e.length-1].nodo.remove(),e.pop()}},t=function(e){var o=a("/soloTexto.html");$.when(o).then(function(a){c("alerta",a,{html:{".mensaje_texto":e}})})},r=function(e){$.when(e).then(function(){t("Hecho!")},function(){t("Error :(")})},i=function(e,a){moduloLocal.procesarElemento(e);var o={funciones:{".menu_opc_ingresar":moduloApp.login,".menu_opc_salir":moduloApp.logout,".menu_opc_borrar_cache":moduloApp.borrarCache,".create-ui-toggle2":moduloApp.abrirBarraEdicion,".menuEliminar":moduloEdicion.funcElegirBorrar},html:{}};o=$.extend(o,a),$.each(o.funciones,function(a,o){e.find(a).on("click",function(){n();var e=o();hayValor(e)&&r(e)})});for(var t in o.html)e.find(t).html(o.html[t])},c=function(a,o,n){var t=$(o);$("body").append(t),e.push({id:a,nodo:t}),i(t,n)},d=function(){var e=$.Deferred();if(o("menu"))return n(),e.reject(),e.promise();var t=null;return t=a(moduloApp.esUsuario()?moduloApp.esAdmin()?"/menuInicialAdmin.html":"/menuInicialAnonimo.html":"/menuInicialAnonimo.html"),$.when(t).then(function(a){c("menu",a),e.resolve()}),e.promise()},l=function(){pila.push("menu_pagina"),$(".menu_core").toggleClass("invisible"),$(".menu_pagina").toggleClass("invisible"),window.scrollTo(0,0)},u=function(e,a,o,n){pila.push("formhtml"),console.log("mostrarFormularioEdicion",e,a,o),$(".formhtml").attr("nodo2",e),$(".formhtml").attr("property2",a),$(".formhtml").attr("sufijo",n),$(".formhtml textarea").val(o),$(".formhtml").removeClass("invisible")};return $(document).keyup(function(a){27==a.keyCode&&(0==e.length?d():n())}),{mostrarMenuPagina:l,mostrarFormularioEdicion:u,mostrarMenuBasico:d,mostrarMenuSoloTexto:t}}();if(!hayValor(moduloApp))var moduloApp=function(){var e={URL_LOGIN:URL_LOGIN,URL_LOGOUT:URL_LOGOUT,HAS_USER:HAS_USER,IS_ADMIN:IS_ADMIN},a=function(){return e.IS_ADMIN},o=function(){return e.HAS_USER},n=function(){window.location.href=e.URL_LOGIN},t=function(){window.location.href=e.URL_LOGOUT},r=function(){"full"===$("body").data("Midgard-midgardToolbar").options.display?($("body").data("Midgard-midgardToolbar").__proto__.hide(),$("body").data("Midgard-midgardToolbar").options.display="minimized"):($("body").data("Midgard-midgardToolbar").__proto__.show(),$("body").data("Midgard-midgardToolbar").options.display="full")};return{esAdmin:a,esUsuario:o,login:n,logout:t,borrarCache:function(){var e=$.Deferred();return moduloActividad.on(),$.ajax({type:"GET",url:"/act/clearmemcache",data:JSON.stringify({}),contentType:"application/json; charset=utf-8"}).done(function(a){e.resolve()}).fail(function(a,o){e.reject()}).always(function(){moduloActividad.off()}),e.promise()},abrirBarraEdicion:r}}();if(!hayValor(moduloArchivos))var moduloArchivos=function(){var e=function(e){var a={maximoTamanio:512e3,tipos:"image/*",auto:"true",dataFolder:"/imagenesbasico"};for(var o in a)hayValor(e[o])||(e[o]=a[o]);return e},a=function(a){var o=$.Deferred();a=e(a);var n=$('<input type="file" class="invisible" accept="'+a.tipos+'">');return n.on("change",function(e){var n=e.target.files[0];if(n.size>a.maximoTamanio)return alert("Archivo muy grande! debe ser menor a "+a.maximoTamanio/1024+" KB"),void o.reject();(new FileReader).readAsDataURL(n);var t=new FormData;t.append("file-0",n),t.append("folder",a.dataFolder),hayValor(a.id)&&t.append("name",a.id),"false"==a.auto&&t.append("auto","false"),moduloActividad.on(),$.ajax({url:"/storage/",type:"POST",data:t,headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(e){0!=e.error?o.reject():o.resolve(e)}).fail(function(){o.reject()}).always(function(){moduloActividad.off()})}),n.click(),o.promise()},o=function(e,a){var o=$.Deferred(),n={type:"text/plain"},t=new File([a],e,n),r=new FormData;return r.append("file-0",t),r.append("auto","false"),r.append("name",e),moduloActividad.on(),$.ajax({url:"/storage/",type:"POST",data:r,headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(e){0!=e.error?o.reject():o.resolve()}).fail(function(){o.reject()}).always(function(){moduloActividad.off()}),o.promise()};return{leerTextoPlano:function(e){var a=$.Deferred();return moduloActividad.on(),$.ajax({url:"/storage/read?name="+encodeURIComponent(e),type:"GET",cache:!1,contentType:!1,processData:!1}).done(function(e){a.resolve(e)}).fail(function(){a.reject()}).always(function(){moduloActividad.off()}),a.promise()},escribirTextoPlano:o,subirArchivo:a}}();if(!hayValor(moduloEditorTexto))var moduloEditorTexto=function(e){var a=function(){e.empty();var a=$("<div/>",{id:"pluginEditor"});e.append(a)},o=function(e){var a=ace.edit("pluginEditor"),o=moduloArchivos.escribirTextoPlano(e,a.getValue());$.when(o).then(function(){alert("Archivo guardado!")},function(){alert("Error subiendo el archivo")})};return{abrirEditor:function(e,n,t){var r=[{patron:/.*\.js/gi,editor:"ace/mode/javascript"},{patron:/.*\.html/gi,editor:"ace/mode/html"},{patron:/.*\.json/gi,editor:"ace/mode/json"},{patron:/.*\.css/gi,editor:"ace/mode/css"},{patron:/.*\.xml/gi,editor:"ace/mode/xml"}];a();var i=ace.edit("pluginEditor");i.setValue(n),i.setTheme("ace/theme/monokai"),i.commands.addCommand({name:"comandoGuardar",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(e){o(t)},readOnly:!0});for(var c=0;c<r.length;c++){var d=r[c];d.patron.test(e)&&i.getSession().setMode(d.editor)}},destruirEditor:a}};if(!hayValor(moduloArbolArchivos))var moduloArbolArchivos=function(e,a){var o=moduloEditorTexto(a);e.on("changed.jstree",function(e,a){if(a.selected.length){a.instance.get_node(a.selected[0])}}),e.on("rename_node.jstree",function(e,a){var o=(a.old,a.text),n=a.node;"folder"==n.original.type?a.instance.set_id(n,a.node.parent+o+"/"):a.instance.set_id(n,a.node.parent+o)}),e.on("load_node.jstree",function(e,a){for(var o=a.instance,t=0;t<a.node.children.length;t++){var r=a.node.children[t],i=o.get_node(r);n(i)}}),e.on("create_node.jstree",function(e,a){n(a.node)});var n=function(a){"file"==a.original.type&&e.jstree(!0).set_icon(a.id,"/assets/js/jstree/themes/default/file.png")},t=function(e){var a={separator_before:!1,separator_after:!1,label:"Abrir",action:function(e){o.destruirEditor();var a=$.jstree.reference(e.reference),n=a.get_node(e.reference),t=moduloArchivos.leerTextoPlano(n.id);$.when(t).then(function(e){"string"!=typeof e&&(e=""),o.abrirEditor(n.text,e,n.id)})}},n={separator_before:!1,separator_after:!1,label:"Crear carpeta",action:function(e){var a={text:"nuevo",type:"folder"},o=$.jstree.reference(e.reference),n=o.get_node(e.reference);o.create_node(n,a,"last",function(e){setTimeout(function(){o.edit(e)},0)})}},t={separator_before:!1,separator_after:!1,label:"Crear archivo",action:function(e){var a={text:"nuevo",type:"file"},o=$.jstree.reference(e.reference),n=o.get_node(e.reference);o.create_node(n,a,"last",function(e){setTimeout(function(){o.edit(e)},0)})}},r={separator_before:!1,separator_after:!1,label:"Renombrar",action:function(a){$.jstree.reference(a.reference).edit(e)}},i={separator_before:!1,separator_after:!1,label:"Borrar",action:function(a){console.log("borrar"),$.jstree.reference(a.reference).delete_node(e)}};return"folder"==e.original.type?{CrearArchivo:t,CrearCarpeta:n,Borrar:i}:"file"==e.original.type?{Abrir:a,Renombrar:r,Borrar:i}:void 0};return e.jstree({core:{check_callback:!0,themes:{stripes:!0},data:{url:function(e){return"/storage/jstreelist"},dataType:"json",data:function(e){return{id:e.id}}}},contextmenu:{items:t},plugins:["contextmenu","dnd","search","json_data","state","wholerow"]}),{}};if(!hayValor(moduloEdicion))var moduloEdicion=function(){var mapaIds={},activarEdicionOk=!1,activarEdicion=function(){1!=activarEdicionOk&&"undefined"!=typeof Backbone&&(Backbone.sync=function(e,a,o){try{var n=a.toJSON(),t=n["@subject"];a.isNew()&&(t in mapaIds?n["@subject"]=mapaIds[t]:(n["@subject"]="<"+(new Date).getTime()+"_"+Math.floor(10*Math.random()+1)+">",mapaIds[t]=n["@subject"]));var r=n["@subject"],i=n["@type"],c=/(viejs\.org\/ns\/)(.*)(>)/g.exec(i),d=null;c&&(d=c[2]);var l=/(<)(.*)(>)/g,u=l.exec(r);if(null==u)return void o.error("error: no es identificador "+r);var s=u[2],f={};for(var m in n){var c=/(viejs\.org\/ns\/)(.*)(>)/g.exec(m);c&&(f[c[2]]=n[m])}var p={};switch(p.payload=f,p.leng=LENGUAJE,e){case"create":case"update":moduloActividad.on(),$.ajax({type:"PUT",url:"/rest/"+(null===d||void 0===d?"Documento":d)+"/"+s,data:JSON.stringify(p),contentType:"application/json; charset=utf-8"}).done(function(e){o.success(a)}).fail(function(e,a){o.error("error")}).always(function(){moduloActividad.off()})}}catch(e){o.error("error "+e)}},activarEdicionOk=!0)},activarPaginacion=function activarPaginacion(nodo){function activatePageA(actual){var cursor=actual.attr("data-next"),busqueda=JSON.parse(actual.attr("data-q")),template=actual.attr("data-tpl"),target=actual.attr("data-target"),ipage=parseInt(actual.attr("data-page"));busqueda.n||(busqueda.n=100),moduloApp.esAdmin()||actual.html(ipage*busqueda.n+1+" al "+(ipage+1)*busqueda.n),"1"===actual.attr("data-noa")&&(actual.removeAttr("href"),actual.on("click",function(){var docHtml=document.getElementById(template).innerHTML,destino=$(target),postload=destino.attr("data-postload");destino.length>0&&(moduloActividad.on(),$.ajax({type:"PUT",url:"/paginar/",data:JSON.stringify({busqueda:busqueda,cursor:cursor}),contentType:"application/json; charset=utf-8"}).done(function(msg){var datos=msg.datos,sigui=msg.next;destino.empty();for(var i=0;i<datos.length;i++){var dato=datos[i],nuevo=$(docHtml);llenarTemplate(nuevo,dato),destino.append(nuevo)}if(void 0!==sigui&&sigui.length>0){var padrePaginacion=actual.closest(".paginacion");if(0==padrePaginacion.find("[data-next='"+sigui+"']").length){for(var padreLocal=actual.parent(),nombreTAG=padreLocal.prop("tagName"),cambio=!1;padreLocal.get(0)!=padrePaginacion.get(0)&&"BODY"!=nombreTAG;)cambio=!0,actual=padreLocal,padreLocal=padreLocal.parent(),nombreTAG=padreLocal.prop("tagName");var paginaSigui=actual.clone(),paginaSigui2;paginaSigui2=cambio?paginaSigui.find("[data-next]"):paginaSigui,paginaSigui2.attr("data-page",ipage+1),paginaSigui2.attr("data-next",sigui),padrePaginacion.append(paginaSigui),activatePageA(paginaSigui2)}}void 0!==postload&&eval(postload)}).fail(function(e,a){moduloMenus.mostrarMenuSoloTexto("Error paginando")}).always(function(){moduloActividad.off()}))}))}hayValor(nodo)||(nodo=$("body")),$.each(nodo.find("a[data-next]"),function(e,a){activatePageA($(a))})},funcElegirBorrar=function(){var e=$(".btnEliminar");e.length>0?e.remove():$("[about]").each(function(e){var a=$(this),o=a.find(".btnEliminar");if(0==o.length){a.prepend($('<div class="btnEliminar"><div class="btnEliminarX btnEliminar2 manito"></div><div class="btnEliminarX opciones invisible">\t<div class="btnEliminar3"></div>\t<div class="btnEliminar4 manito">Cancelar</div>\t<div class="btnEliminar5 manito">Aceptar</div></div></div>')),o=a.find(".btnEliminar");var n=o.find(".btnEliminar2"),t=o.find(".btnEliminar4"),r=o.find(".btnEliminar5");n.click(function(){var e=$(this);e.addClass("invisible"),e.siblings(".opciones").removeClass("invisible")}),r.click(function(){var e=$(this),a=e.closest("[about]");if(a.length>0){var o=a.attr("about"),n=null;n=a.attr("typeof");var t=(null===n||void 0===n?"":n)+"_"+o;t in mapaIds&&(o=mapaIds[t]),moduloActividad.on(),$.ajax({type:"DELETE",url:"/rest/"+(null===n||void 0===n?"":n)+"/"+o}).done(function(e){a.remove(),$("body").data("Midgard-midgardNotifications").create({body:JSON.stringify(e)}),location.reload()}).fail(function(e,a){$("body").data("Midgard-midgardNotifications").create({body:TRADUCTOR.error_ajax[LENGUAJE]})}).always(function(){moduloActividad.off()})}}),t.click(function(){var e=$(this);e.closest(".opciones").addClass("invisible"),e.closest(".btnEliminar").find(".btnEliminar2").removeClass("invisible")})}}),"menu"===pila[pila.length-1]&&pila.pop()};return activarPaginacion(),{activarPaginacion:activarPaginacion,activarEdicion:activarEdicion,funcElegirBorrar:funcElegirBorrar}}();$(function(){$("#paginaCompleta").enhsplitter({minSize:60,vertical:!1,position:60}),$("#totalArchivos").enhsplitter({minSize:60,position:350}),moduloArbolArchivos($("#contenedorArchivos"),$("editorTexto"))});