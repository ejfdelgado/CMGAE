$(function(){var e=function(){$("editorTexto").empty();var e=$("<div/>",{id:"pluginEditor"});$("editorTexto").append(e)},r=function(r,t){var a=[{patron:/.*\.js/gi,editor:"ace/mode/javascript"},{patron:/.*\.html/gi,editor:"ace/mode/html"}];e();var n=ace.edit("pluginEditor");n.setValue(t),n.setTheme("ace/theme/monokai");for(var o=0;o<a.length;o++){var i=a[o];i.patron.test(r)&&n.getSession().setMode(i.editor)}},t=function(e){var r=ace.edit("pluginEditor"),t={type:"text/plain"},a=new File(r.getValue(),e,t),n=new FormData;n.append("file-0",a),n.append("auto",!1),n.append("name",e),$.ajax({url:"/storage/",type:"POST",data:n,headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(e){0!=e.error?alert("Error subiendo el archivo"):console.log("ok")}).fail(function(){alert("Error subiendo el archivo")}).always(function(){})},a=function(e,r){$.ajax({url:"/storage/read?name="+encodeURIComponent(e),type:"GET",cache:!1,contentType:!1,processData:!1}).done(function(e){r("Hola!")}).fail(function(){alert("Error leyendo contenido")}).always(function(){})};$("#paginaCompleta").enhsplitter({minSize:60,vertical:!1,position:60}),$("#totalArchivos").enhsplitter({minSize:60,position:350}),$("#contenedorArchivos").on("changed.jstree",function(e,r){if(r.selected.length){r.instance.get_node(r.selected[0])}}),$("#contenedorArchivos").jstree({core:{check_callback:!0,themes:{stripes:!0},data:{url:function(e){return"/storage/jstreelist"},dataType:"json",data:function(e){return{id:e.id}}}},types:{"#":{max_children:1,max_depth:4,valid_children:["root"]},root:{valid_children:["default"]},default:{valid_children:["default","file"]},file:{icon:"/assets/js/jstree/themes/default/file.png",valid_children:[]}},contextmenu:{items:function(n){return{Abrir:{separator_before:!1,separator_after:!1,label:"Abrir",action:function(t){e();var n=$.jstree.reference(t.reference),o=n.get_node(t.reference);a(o.id,function(e){r(o.text,e)})}},Guardar:{separator_before:!1,separator_after:!1,label:"Abrir",action:function(e){var r=$.jstree.reference(e.reference),a=r.get_node(e.reference);t(a.id)}},Create:{separator_before:!1,separator_after:!1,label:"Crear",action:function(e){}},Rename:{separator_before:!1,separator_after:!1,label:"Renombrar",action:function(e){$.jstree.reference(e.reference).edit(n)}},Remove:{separator_before:!1,separator_after:!1,label:"Borrar",action:function(e){console.log("borrar"),$.jstree.reference(e.reference).delete_node(n)}}}}},plugins:["contextmenu","dnd","search","json_data","state","types","wholerow"]})});