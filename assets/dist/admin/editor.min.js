var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hayValor=function(e){return void 0!=e&&null!=e&&(!("string"==typeof e)||e.trim().length>0)},esFuncion=function(e){return"function"==typeof e},esNumero=function(e){return"number"==typeof e||/^\d+$/.test(e)},esBoolean=function(e){return"boolean"==typeof e},esObjeto=function(e){return"object"==(void 0===e?"undefined":_typeof(e))&&null!==e},esLista=function(e){return hayValor(e)&&e instanceof Array},esMultilenguaje=function(e){return/^(\S)+(\.\S+)+$/gim.test(e)},leerObj=function(e,o,a,n){if(!hayValor(o)||!esObjeto(e))return a;for(var t=o.split("."),r=e,i=0;i<t.length;i++){var c=t[i];if(esNumero(c)&&esLista(r)&&(c=parseInt(c)),r=r[c],i!=t.length-1&&!esObjeto(r))return a}return hayValor(r)?!0!==n&&esFuncion(r)?r():r:a},asignarObj=function(e,o,a){for(var n=o.split("."),t=e,r=0;r<n.length;r++){var i=n[r];esNumero(i)&&(i=parseInt(i)),esObjeto(t)&&(r==n.length-1?esLista(t[i])&&esLista(a)&&t[i]!==a?(t[i].splice(0,t[i].length),$.each(a,function(e,o){t[i].push(o)})):t[i]=a:((Object.keys(t).indexOf(""+i)<0||null==t[i])&&(esNumero(n[r+1])?t[i]=[]:t[i]={}),t=t[i]))}},darRutasObjeto=function(e,o){var a=[];return function e(n,t){esObjeto(n)?$.each(n,function(n,r){var i=null;i=null===t?n:t+"."+n,esFuncion(o)&&o(r)&&a.push(i),e(r,i)}):null!==t&&(esFuncion(o)?o(n)&&a.push(t):a.push(t))}(e,null),a},predefinir=function(e,o){for(var a=darRutasObjeto(o),n=0;n<a.length;n++){var t=a[n];if(!hayValor(leerObj(e,t,null,!0))){var r=leerObj(o,t,null,!0);asignarObj(e,t,r)}}return e};if(!hayValor(moduloActividad))var moduloActividad=function(){var e=0;return{on:function(o){if(hayValor(o)||(o=""),0==e){var a=$('<div id="loading"><p></p></div>');a.find("p").html(o),$("body").append(a)}e++},off:function(){--e<=0&&(e=0,$("#loading").remove())}}}();if(!hayValor(moduloHttp))var moduloHttp=function(){return{get:function(e){var o=$.Deferred();return moduloActividad.on(),$.ajax({url:e,type:"GET",cache:!1}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}).always(function(){moduloActividad.off()}),o.promise()}}}();if(!hayValor(moduloLocal))var moduloLocal=function(){var e={lengua:LENGUAJE},o=null,a=function(e){return esObjeto(o)?leerObj(o,e,e):e},n=function(e){$.each(e.find(".traducir"),function(e,o){var n=$(o),t=n.text();if(esMultilenguaje(t)){var r=a(t);r!=t&&n.html(r)}})};return function(){var a=moduloHttp.get("/assets/cmgae/local/"+e.lengua+".json");$.when(a).then(function(e){o=JSON.parse(e)})}(),{traducir:a,procesarElemento:n}}();if(!hayValor(moduloMenus))var moduloMenus=function(){var e=[],o=function(e){return moduloHttp.get("/assets/cmgae/menus"+e)},a=function(o){return 0!=e.length&&e[e.length-1].id==o},n=function(){if(0!=e.length){e[e.length-1].nodo.remove(),e.pop()}},t=function(e){var a=o("/soloTexto.html");$.when(a).then(function(o){l("alerta",o,{html:{".mensaje_texto":e}})})},r=function(){t(moduloLocal.traductir("menus.mensajes.error"))},i=function(e){$.when(e).then(function(){t(moduloLocal.traductir("menus.mensajes.hecho"))},r)},c=function(e,o){moduloLocal.procesarElemento(e);var a={funciones:{".menu_opc_ingresar":moduloApp.login,".menu_opc_salir":moduloApp.logout,".menu_opc_borrar_cache":moduloApp.borrarCache,".create-ui-toggle2":moduloApp.abrirBarraEdicion,".menuEliminar":moduloEdicion.funcElegirBorrar},html:{},botones:{}};if(a=$.extend(a,o),$.each(a.funciones,function(o,a){e.find(o).on("click",function(){n();var e=a();hayValor(e)&&i(e)})}),esObjeto(a.botones)){var t=$('<div class="row"><div class="col-xs-12"><div class="text-right botones-aca"></div></div></div>'),r={texto:"?",clase:"btn-primary",accion:function(){}};$.each(a.botones,function(e,o){predefinir(o,r);var a=$('<button type="button" class="btn btn-xs"></button>');a.on("click",o.accion),a.addClass(o.clase),a.text(o.texto),t.find(".botones-aca").append(a)}),e.append(t)}for(var c in a.html)e.find(c).html(a.html[c])},d=function(){var e=o("/confirmar.html"),a=$.Deferred();return $.when(e).then(function(e){var o={botones:{aceptar:{texto:moduloLocal.traducir("menus.botones.aceptar"),clase:"btn-success",accion:function(){a.resolve()}},cancelar:{texto:moduloLocal.traducir("menus.botones.cancelar"),clase:"btn-danger",accion:function(){a.reject()}}}};l("confirmacion",e,o)}),a.promise()},l=function(o,a,n){var t=$(a);$("body").append(t),e.push({id:o,nodo:t}),c(t,n)},u=function(){var e=$.Deferred();if(a("menu"))return n(),e.reject(),e.promise();var t=null;return t=o(moduloApp.esUsuario()?moduloApp.esAdmin()?"/menuInicialAdmin.html":"/menuInicialAnonimo.html":"/menuInicialAnonimo.html"),$.when(t).then(function(o){l("menu",o),e.resolve()}),e.promise()},s=function(){pila.push("menu_pagina"),$(".menu_core").toggleClass("invisible"),$(".menu_pagina").toggleClass("invisible"),window.scrollTo(0,0)},f=function(e,o,a,n){pila.push("formhtml"),console.log("mostrarFormularioEdicion",e,o,a),$(".formhtml").attr("nodo2",e),$(".formhtml").attr("property2",o),$(".formhtml").attr("sufijo",n),$(".formhtml textarea").val(a),$(".formhtml").removeClass("invisible")};return $(document).keyup(function(o){27==o.keyCode&&(0==e.length?u():n())}),{mostrarMenuPagina:s,mostrarFormularioEdicion:f,mostrarMenuBasico:u,mostrarMenuSoloTexto:t,confirmar:d,sacarUltimo:n,error:r}}();if(!hayValor(moduloApp))var moduloApp=function(){var e={URL_LOGIN:URL_LOGIN,URL_LOGOUT:URL_LOGOUT,HAS_USER:HAS_USER,IS_ADMIN:IS_ADMIN},o=function(){return e.IS_ADMIN},a=function(){return e.HAS_USER},n=function(){moduloActividad.on(),window.location.href=e.URL_LOGIN},t=function(){moduloActividad.on(),window.location.href=e.URL_LOGOUT},r=function(){"full"===$("body").data("Midgard-midgardToolbar").options.display?($("body").data("Midgard-midgardToolbar").__proto__.hide(),$("body").data("Midgard-midgardToolbar").options.display="minimized"):($("body").data("Midgard-midgardToolbar").__proto__.show(),$("body").data("Midgard-midgardToolbar").options.display="full")};return{esAdmin:o,esUsuario:a,login:n,logout:t,borrarCache:function(){var e=$.Deferred();return moduloActividad.on(),$.ajax({type:"GET",url:"/act/clearmemcache",data:JSON.stringify({}),contentType:"application/json; charset=utf-8"}).done(function(o){e.resolve()}).fail(function(o,a){e.reject()}).always(function(){moduloActividad.off()}),e.promise()},abrirBarraEdicion:r}}();if(!hayValor(moduloArchivos))var moduloArchivos=function(){var e=function(e){var o={maximoTamanio:512e3,tipos:"image/*",auto:"true",dataFolder:"/imagenesbasico"};for(var a in o)hayValor(e[a])||(e[a]=o[a]);return e},o=function(o){var a=$.Deferred();o=e(o);var n=$('<input type="file" class="invisible" accept="'+o.tipos+'">');return n.on("change",function(e){var n=e.target.files[0];if(n.size>o.maximoTamanio)return alert("Archivo muy grande! debe ser menor a "+o.maximoTamanio/1024+" KB"),void a.reject();(new FileReader).readAsDataURL(n);var t=new FormData;t.append("file-0",n),t.append("folder",o.dataFolder),hayValor(o.id)&&t.append("name",o.id),"false"==o.auto&&t.append("auto","false"),moduloActividad.on(),$.ajax({url:"/storage/",type:"POST",data:t,headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(e){0!=e.error?a.reject():a.resolve(e)}).fail(function(){a.reject()}).always(function(){moduloActividad.off()})}),n.click(),a.promise()},a=function(e,o){var a=$.Deferred(),n={type:"text/plain"},t=new File([o],e,n),r=new FormData;return r.append("file-0",t),r.append("auto","false"),r.append("name",e),moduloActividad.on(),$.ajax({url:"/storage/",type:"POST",data:r,headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(e){0!=e.error?a.reject():a.resolve()}).fail(function(){a.reject()}).always(function(){moduloActividad.off()}),a.promise()};return{leerTextoPlano:function(e){var o=$.Deferred();return moduloActividad.on(),$.ajax({url:"/storage/read?name="+encodeURIComponent(e),type:"GET",cache:!1,contentType:!1,processData:!1}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}).always(function(){moduloActividad.off()}),o.promise()},escribirTextoPlano:a,subirArchivo:o}}();if(!hayValor(moduloEditorTexto))var moduloEditorTexto=function(e){var o=function(){e.empty();var o=$("<div/>",{id:"pluginEditor"});e.append(o)},a=function(e){var o=ace.edit("pluginEditor"),a=moduloArchivos.escribirTextoPlano(e,o.getValue());$.when(a).then(function(){alert("Archivo guardado!")},function(){alert("Error subiendo el archivo")})};return{abrirEditor:function(e,n,t){var r=[{patron:/.*\.js/gi,editor:"ace/mode/javascript"},{patron:/.*\.html/gi,editor:"ace/mode/html"},{patron:/.*\.json/gi,editor:"ace/mode/json"},{patron:/.*\.css/gi,editor:"ace/mode/css"},{patron:/.*\.xml/gi,editor:"ace/mode/xml"}];o();var i=ace.edit("pluginEditor");i.setValue(n),i.setTheme("ace/theme/monokai"),i.commands.addCommand({name:"comandoGuardar",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(e){a(t)},readOnly:!0});for(var c=0;c<r.length;c++){var d=r[c];d.patron.test(e)&&i.getSession().setMode(d.editor)}},destruirEditor:o}};if(!hayValor(moduloArbolArchivos))var moduloArbolArchivos=function(e,o){var a=moduloEditorTexto(o);e.on("changed.jstree",function(e,o){if(o.selected.length){o.instance.get_node(o.selected[0])}}),e.on("rename_node.jstree",function(e,o){var a=(o.old,o.text),n=o.node;"folder"==n.original.type?o.instance.set_id(n,o.node.parent+a+"/"):o.instance.set_id(n,o.node.parent+a)}),e.on("load_node.jstree",function(e,o){for(var a=o.instance,t=0;t<o.node.children.length;t++){var r=o.node.children[t],i=a.get_node(r);n(i)}}),e.on("create_node.jstree",function(e,o){n(o.node)});var n=function(o){"file"==o.original.type&&e.jstree(!0).set_icon(o.id,"/assets/js/jstree/themes/default/file.png")},t=function(e){var o={separator_before:!1,separator_after:!1,label:"Abrir",action:function(e){a.destruirEditor();var o=$.jstree.reference(e.reference),n=o.get_node(e.reference),t=moduloArchivos.leerTextoPlano(n.id);$.when(t).then(function(e){"string"!=typeof e&&(e=""),a.abrirEditor(n.text,e,n.id)})}},n={separator_before:!1,separator_after:!1,label:"Crear carpeta",action:function(e){var o={text:"nuevo",type:"folder"},a=$.jstree.reference(e.reference),n=a.get_node(e.reference);a.create_node(n,o,"last",function(e){setTimeout(function(){a.edit(e)},0)})}},t={separator_before:!1,separator_after:!1,label:"Crear archivo",action:function(e){var o={text:"nuevo",type:"file"},a=$.jstree.reference(e.reference),n=a.get_node(e.reference);a.create_node(n,o,"last",function(e){setTimeout(function(){a.edit(e)},0)})}},r={separator_before:!1,separator_after:!1,label:"Renombrar",action:function(o){$.jstree.reference(o.reference).edit(e)}},i={separator_before:!1,separator_after:!1,label:"Borrar",action:function(o){console.log("borrar"),$.jstree.reference(o.reference).delete_node(e)}};return"folder"==e.original.type?{CrearArchivo:t,CrearCarpeta:n,Borrar:i}:"file"==e.original.type?{Abrir:o,Renombrar:r,Borrar:i}:void 0};return e.jstree({core:{check_callback:!0,themes:{stripes:!0},data:{url:function(e){return"/storage/jstreelist"},dataType:"json",data:function(e){return{id:e.id}}}},contextmenu:{items:t},plugins:["contextmenu","dnd","search","json_data","state","wholerow"]}),{}};if(!hayValor(moduloEdicion))var moduloEdicion=function(){var mapaIds={},activarEdicionOk=!1,activarEdicion=function(){1!=activarEdicionOk&&"undefined"!=typeof Backbone&&(Backbone.sync=function(e,o,a){try{var n=o.toJSON(),t=n["@subject"];o.isNew()&&(t in mapaIds?n["@subject"]=mapaIds[t]:(n["@subject"]="<"+(new Date).getTime()+"_"+Math.floor(10*Math.random()+1)+">",mapaIds[t]=n["@subject"]));var r=n["@subject"],i=n["@type"],c=/(viejs\.org\/ns\/)(.*)(>)/g.exec(i),d=null;c&&(d=c[2]);var l=/(<)(.*)(>)/g,u=l.exec(r);if(null==u)return void a.error("error: no es identificador "+r);var s=u[2],f={};for(var m in n){var c=/(viejs\.org\/ns\/)(.*)(>)/g.exec(m);c&&(f[c[2]]=n[m])}var p={};switch(p.payload=f,p.leng=LENGUAJE,e){case"create":case"update":moduloActividad.on(),$.ajax({type:"PUT",url:"/rest/"+(null===d||void 0===d?"Documento":d)+"/"+s,data:JSON.stringify(p),contentType:"application/json; charset=utf-8"}).done(function(e){a.success(o)}).fail(function(e,o){a.error("error")}).always(function(){moduloActividad.off()})}}catch(e){a.error("error "+e)}},activarEdicionOk=!0)},activarPaginacion=function activarPaginacion(nodo){function activatePageA(actual){var cursor=actual.attr("data-next"),busqueda=JSON.parse(actual.attr("data-q")),template=actual.attr("data-tpl"),target=actual.attr("data-target"),ipage=parseInt(actual.attr("data-page"));busqueda.n||(busqueda.n=100),moduloApp.esAdmin()||actual.html(ipage*busqueda.n+1+" al "+(ipage+1)*busqueda.n),"1"===actual.attr("data-noa")&&(actual.removeAttr("href"),actual.on("click",function(){var docHtml=document.getElementById(template).innerHTML,destino=$(target),postload=destino.attr("data-postload");destino.length>0&&(moduloActividad.on(),$.ajax({type:"PUT",url:"/paginar/",data:JSON.stringify({busqueda:busqueda,cursor:cursor}),contentType:"application/json; charset=utf-8"}).done(function(msg){var datos=msg.datos,sigui=msg.next;destino.empty();for(var i=0;i<datos.length;i++){var dato=datos[i],nuevo=$(docHtml);llenarTemplate(nuevo,dato),destino.append(nuevo)}if(void 0!==sigui&&sigui.length>0){var padrePaginacion=actual.closest(".paginacion");if(0==padrePaginacion.find("[data-next='"+sigui+"']").length){for(var padreLocal=actual.parent(),nombreTAG=padreLocal.prop("tagName"),cambio=!1;padreLocal.get(0)!=padrePaginacion.get(0)&&"BODY"!=nombreTAG;)cambio=!0,actual=padreLocal,padreLocal=padreLocal.parent(),nombreTAG=padreLocal.prop("tagName");var paginaSigui=actual.clone(),paginaSigui2;paginaSigui2=cambio?paginaSigui.find("[data-next]"):paginaSigui,paginaSigui2.attr("data-page",ipage+1),paginaSigui2.attr("data-next",sigui),padrePaginacion.append(paginaSigui),activatePageA(paginaSigui2)}}void 0!==postload&&eval(postload)}).fail(function(e,o){moduloMenus.mostrarMenuSoloTexto("Error paginando")}).always(function(){moduloActividad.off()}))}))}hayValor(nodo)||(nodo=$("body")),$.each(nodo.find("a[data-next]"),function(e,o){activatePageA($(o))})},funcElegirBorrar=function(){var e=$(".btnEliminar");e.length>0?e.remove():$("[about]").each(function(e,o){var a=$(o),n=a.find(".btnEliminar");if(0==n.length){a.prepend($('<div class="btnEliminar"><div class="btnEliminarX btnEliminar2 manito"></div></div>')),n=a.find(".btnEliminar");n.find(".btnEliminar2").click(function(){var e=moduloMenus.confirmar();$.when(e).then(function(){var e=a,o=e.attr("about"),n=null;n=e.attr("typeof");var t=(hayValor(n)?n:"")+"_"+o;t in mapaIds&&(o=mapaIds[t]),moduloActividad.on(),$.ajax({type:"DELETE",url:"/rest/"+(hayValor(n)?n:"")+"/"+o}).done(function(o){e.remove(),$("body").data("Midgard-midgardNotifications").create({body:JSON.stringify(o)}),location.reload()}).fail(function(e,o){$("body").data("Midgard-midgardNotifications").create({body:TRADUCTOR.error_ajax[LENGUAJE]})}).always(function(){moduloActividad.off()}),moduloMenus.sacarUltimo()},function(){moduloMenus.sacarUltimo()})})}}),"menu"===pila[pila.length-1]&&pila.pop()};return activarPaginacion(),{activarPaginacion:activarPaginacion,activarEdicion:activarEdicion,funcElegirBorrar:funcElegirBorrar}}();$(function(){$("#paginaCompleta").enhsplitter({minSize:60,vertical:!1,position:60}),$("#totalArchivos").enhsplitter({minSize:60,position:350}),moduloArbolArchivos($("#contenedorArchivos"),$("editorTexto"))});