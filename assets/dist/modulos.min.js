var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},hayValor=function(a){return void 0!=a&&null!=a&&(!("string"==typeof a)||a.trim().length>0)},esFuncion=function(a){return"function"==typeof a},esNumero=function(a){return"number"==typeof a||/^\d+$/.test(a)},esBoolean=function(a){return"boolean"==typeof a},esObjeto=function(a){return"object"==(void 0===a?"undefined":_typeof(a))&&null!==a},esLista=function(a){return hayValor(a)&&a instanceof Array},esMultilenguaje=function(a){return/^(\S)+(\.\S+)+$/gim.test(a)},leerObj=function(a,e,t,o){if(!hayValor(e)||!esObjeto(a))return t;for(var r=e.split("."),n=a,i=0;i<r.length;i++){var c=r[i];if(esNumero(c)&&esLista(n)&&(c=parseInt(c)),n=n[c],i!=r.length-1&&!esObjeto(n))return t}return hayValor(n)?!0!==o&&esFuncion(n)?n():n:t},asignarObj=function(a,e,t){for(var o=e.split("."),r=a,n=0;n<o.length;n++){var i=o[n];esNumero(i)&&(i=parseInt(i)),esObjeto(r)&&(n==o.length-1?esLista(r[i])&&esLista(t)&&r[i]!==t?(r[i].splice(0,r[i].length),$.each(t,function(a,e){r[i].push(e)})):r[i]=t:((Object.keys(r).indexOf(""+i)<0||null==r[i])&&(esNumero(o[n+1])?r[i]=[]:r[i]={}),r=r[i]))}},darRutasObjeto=function(a,e){var t=[];return function a(o,r){esObjeto(o)?$.each(o,function(o,n){var i=null;i=null===r?o:r+"."+o,esFuncion(e)&&e(n)&&t.push(i),a(n,i)}):null!==r&&(esFuncion(e)?e(o)&&t.push(r):t.push(r))}(a,null),t},predefinir=function(a,e){for(var t=darRutasObjeto(e),o=0;o<t.length;o++){var r=t[o];if(!hayValor(leerObj(a,r,null,!0))){var n=leerObj(e,r,null,!0);asignarObj(a,r,n)}}return a},configurarListasEditor=function(a,e){a.use(new a.RdfaService);for(var t in e){for(var o=t+"Rel",r=e[t],n=[],i=0;i<r.campos.length;i++){var c=r.campos[i];n.push({id:c.nombre,range:c.tipo,min:0,max:1})}a.types.add(t,n);for(var d=0;d<r.listas.length;d++){var l=r.listas[d];a.types.add(l.nombre,[{id:o,range:t,min:0,max:-1}])}a.service("rdfa").setTemplate(t,o,jQuery(r.ejemplo).html())}},tieneAtributo=function(a,e){var t=a.attr(e);return"undefined"!==(void 0===t?"undefined":_typeof(t))&&!1!==t},activarConteoRegresivo=function(){$(".mycountdown").each(function(a,e){var t=$(e),o=t.text(),r=t.attr("data-count-format");t.countdown(o,function(a){$(this).text(a.strftime(r))})})};if(!hayValor(moduloActividad))var moduloActividad=function(){var a=0;return{on:function(e){if(hayValor(e)||(e=""),0==a){var t=$('<div id="loading"><p></p></div>');t.find("p").html(e),$("body").append(t)}a++},off:function(){--a<=0&&(a=0,$("#loading").remove())}}}();if(!hayValor(moduloHttp))var moduloHttp=function(){return{get:function(a){var e=$.Deferred();return moduloActividad.on(),$.ajax({url:a,type:"GET",cache:!1}).done(function(a){e.resolve(a)}).fail(function(){e.reject()}).always(function(){moduloActividad.off()}),e.promise()}}}();if(!hayValor(moduloLocal))var moduloLocal=function(){var a={lengua:LENGUAJE,lenguapred:LENGUAJE_PRED},e=null,t=function(){var t=$.Deferred(),o=moduloHttp.get("/assets/cmgae/local/"+a.lengua+".json");return $.when(o).then(function(a){e=JSON.parse(a),t.resolve()}),i($("body")),c(),t.promise()},o=function(a){return esObjeto(e)?leerObj(e,a,a):a},r=function(a){$.each(a.find(".traducir"),function(a,e){var t=$(e),r=t.text();if(esMultilenguaje(r)){var n=o(r);n!=r&&t.html(n)}})},n=function(a,e){var t=a.attr("data-value");if(t){var o=new Date(0);try{o.setUTCSeconds(parseInt(t))}catch(a){}if(a.find("[data-format]").each(function(a,e){var t=$(e),r=t.attr("data-format"),n=$.format.date(o.getTime(),r);t.text(n)}),void 0!==e)return $.format.date(o.getTime(),e)}return""},i=function(a){a.find("[dateProperty]").each(function(a,e){var t=$(e);n(t)})},c=function(){$("[data-lenguaje]").each(function(e,t){var o=$(t),r=o.attr("data-lenguaje");o.off("click","**"),o.on("click",function(){var e=/(http)(s?)(:)(\/\/)(.*?)(\/)((leng-)(.*?)(\/))?(.*)/g.exec(window.location);if(e){for(var t="",o=!0,n=e[9],i=r===a.lenguapred,c=1;c<e.length;c++){var d=e[c];if(c<=6||c>=11)void 0!==d&&(t+=d);else{if(i){if(void 0===n)return}else if(n===r)return;!i&&o&&(t+="leng-"+r+"/",o=!1)}}window.location=t}})})};return{inicializar:t,traducir:o,procesarElemento:r,epochAFechaElem:i}}();if(!hayValor(moduloEditorTexto))var moduloEditorTexto=function(a){var e=function(){a.empty();var e=$("<div/>",{id:"pluginEditor"});a.append(e)},t=function(a){var e=ace.edit("pluginEditor"),t=moduloArchivos.escribirTextoPlano(a,e.getValue());$.when(t).then(function(){alert("Archivo guardado!")},function(){alert("Error subiendo el archivo")})};return{abrirEditor:function(a,o,r){var n=[{patron:/.*\.js/gi,editor:"ace/mode/javascript"},{patron:/.*\.html/gi,editor:"ace/mode/html"},{patron:/.*\.json/gi,editor:"ace/mode/json"},{patron:/.*\.css/gi,editor:"ace/mode/css"},{patron:/.*\.xml/gi,editor:"ace/mode/xml"}];e();var i=ace.edit("pluginEditor");i.setValue(o),i.setTheme("ace/theme/monokai"),i.commands.addCommand({name:"comandoGuardar",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(a){t(r)},readOnly:!0});for(var c=0;c<n.length;c++){var d=n[c];d.patron.test(a)&&i.getSession().setMode(d.editor)}},destruirEditor:e}};if(!hayValor(moduloArchivos))var moduloArchivos=function(){var a=function(a){var e={maximoTamanio:512e3,tipos:"image/*",auto:"true",dataFolder:"/imagenesbasico"};for(var t in e)hayValor(a[t])||(a[t]=e[t]);return a},e=function(e){var t=$.Deferred();e=a(e);var o=$('<input type="file" class="invisible" accept="'+e.tipos+'">');return o.on("change",function(a){var o=a.target.files[0];if(o.size>e.maximoTamanio)return alert("Archivo muy grande! debe ser menor a "+e.maximoTamanio/1024+" KB"),void t.reject();(new FileReader).readAsDataURL(o);var r=new FormData;r.append("file-0",o),r.append("folder",e.dataFolder),hayValor(e.id)&&r.append("name",e.id),"false"==e.auto&&r.append("auto","false"),moduloActividad.on(),$.ajax({url:"/storage/",type:"POST",data:r,headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(a){0!=a.error?t.reject():t.resolve(a)}).fail(function(){t.reject()}).always(function(){moduloActividad.off()})}),o.click(),t.promise()},t=function(a,e){var t=$.Deferred(),o={type:"text/plain"},r=new File([e],a,o),n=new FormData;return n.append("file-0",r),n.append("auto","false"),n.append("name",a),moduloActividad.on(),$.ajax({url:"/storage/",type:"POST",data:n,headers:{"X-CSRFToken":$('[name="csrfmiddlewaretoken"]').val()},cache:!1,contentType:!1,processData:!1}).done(function(a){0!=a.error?t.reject():t.resolve()}).fail(function(){t.reject()}).always(function(){moduloActividad.off()}),t.promise()};return{leerTextoPlano:function(a){var e=$.Deferred();return moduloActividad.on(),$.ajax({url:"/storage/read?name="+encodeURIComponent(a),type:"GET",cache:!1,contentType:!1,processData:!1}).done(function(a){e.resolve(a)}).fail(function(){e.reject()}).always(function(){moduloActividad.off()}),e.promise()},escribirTextoPlano:t,subirArchivo:e}}();if(!hayValor(moduloArbolArchivos))var moduloArbolArchivos=function(a,e){var t=moduloEditorTexto(e);a.on("changed.jstree",function(a,e){if(e.selected.length){e.instance.get_node(e.selected[0])}}),a.on("rename_node.jstree",function(a,e){var t=(e.old,e.text),o=e.node;"folder"==o.original.type?e.instance.set_id(o,e.node.parent+t+"/"):e.instance.set_id(o,e.node.parent+t)}),a.on("load_node.jstree",function(a,e){for(var t=e.instance,r=0;r<e.node.children.length;r++){var n=e.node.children[r],i=t.get_node(n);o(i)}}),a.on("create_node.jstree",function(a,e){o(e.node)});var o=function(e){"file"==e.original.type&&a.jstree(!0).set_icon(e.id,"/assets/js/jstree/themes/default/file.png")},r=function(a){var e={separator_before:!1,separator_after:!1,label:"Abrir",action:function(a){t.destruirEditor();var e=$.jstree.reference(a.reference),o=e.get_node(a.reference),r=moduloArchivos.leerTextoPlano(o.id);$.when(r).then(function(a){"string"!=typeof a&&(a=""),t.abrirEditor(o.text,a,o.id)})}},o={separator_before:!1,separator_after:!1,label:"Crear carpeta",action:function(a){var e={text:"nuevo",type:"folder"},t=$.jstree.reference(a.reference),o=t.get_node(a.reference);t.create_node(o,e,"last",function(a){setTimeout(function(){t.edit(a)},0)})}},r={separator_before:!1,separator_after:!1,label:"Crear archivo",action:function(a){var e={text:"nuevo",type:"file"},t=$.jstree.reference(a.reference),o=t.get_node(a.reference);t.create_node(o,e,"last",function(a){setTimeout(function(){t.edit(a)},0)})}},n={separator_before:!1,separator_after:!1,label:"Renombrar",action:function(e){$.jstree.reference(e.reference).edit(a)}},i={separator_before:!1,separator_after:!1,label:"Borrar",action:function(e){$.jstree.reference(e.reference).delete_node(a)}};return"folder"==a.original.type?{CrearArchivo:r,CrearCarpeta:o,Borrar:i}:"file"==a.original.type?{Abrir:e,Renombrar:n,Borrar:i}:void 0};return a.jstree({core:{check_callback:!0,themes:{stripes:!0},data:{url:function(a){return"/storage/jstreelist"},dataType:"json",data:function(a){return{id:a.id}}}},contextmenu:{items:r},plugins:["contextmenu","dnd","search","json_data","state","wholerow"]}),{}};if(!hayValor(moduloApp))var moduloApp=function(){var a={URL_LOGIN:URL_LOGIN,URL_LOGOUT:URL_LOGOUT,HAS_USER:HAS_USER,IS_ADMIN:IS_ADMIN},e=function(){return a.IS_ADMIN},t=function(){return a.HAS_USER},o=function(){moduloActividad.on(),window.location.href=a.URL_LOGIN},r=function(){moduloActividad.on(),window.location.href=a.URL_LOGOUT},n=function(){"full"===$("body").data("Midgard-midgardToolbar").options.display?($("body").data("Midgard-midgardToolbar").__proto__.hide(),$("body").data("Midgard-midgardToolbar").options.display="minimized"):($("body").data("Midgard-midgardToolbar").__proto__.show(),$("body").data("Midgard-midgardToolbar").options.display="full")},i=function(){var a=$.Deferred();return moduloActividad.on(),$.ajax({type:"GET",url:"/act/clearmemcache",data:JSON.stringify({}),contentType:"application/json; charset=utf-8"}).done(function(e){a.resolve()}).fail(function(e,t){a.reject()}).always(function(){moduloActividad.off()}),a.promise()};return{esAdmin:e,esUsuario:t,login:o,logout:r,borrarCache:i,abrirBarraEdicion:n}}();if(!hayValor(moduloContactenos))var moduloContactenos=function(){function a(a,e,t){var o="div",r=a.prop("tagName");"UL"!=r&&"OL"!=r||(o="li");var n=$("<"+o+' property="'+t+'" class="'+t+'"></'+o+">");n.text(e),a.prepend(n)}function e(a){var e=a.attr("validacion"),t=a.attr("placeholder");if(void 0===t&&(t=a.attr("name")),void 0!==e){void 0===t&&(t=e);var o=new RegExp(e,"gi");if(!a.val().match(o))return{error:1,msg:moduloLocal.traducir("general.verifique")+t}}return{error:0}}function t(a,e){a.find("input[type=text],select,textarea").each(function(a,t){var o=$(t),r=o.attr("name");void 0===r&&(r=o.attr("placeholder")),r in e&&o.val(e[r])}),a.find("input[type=checkbox]").each(function(a,t){var o=$(t),r=o.attr("name");void 0===r&&(r=o.attr("placeholder")),r in e&&(1==e[r]?o.prop("checked",!0):o.prop("checked",!1))}),a.find("input[type=radio]").each(function(a,t){var o=$(t),r=o.attr("name");void 0===r&&(r=o.attr("placeholder")),r in e&&(e[r]==o.attr("value")?o.prop("checked",!0):o.prop("checked",!1))})}function o(a,t){var o=[];return a.find("input[type=text],textarea").each(function(a,t){var r=$(t),n=e(r);o.push(n)}),a.find("input[type=text],select,textarea,input[type=radio]:checked").each(function(a,e){var o=$(e),r=o.attr("name");if(void 0===r&&(r=o.attr("placeholder")),void 0!==r){var n=o.val();t[r]=n}}),a.find("input[type=checkbox]").each(function(a,e){var o=$(e),r=o.attr("name");if(void 0===r&&(r=o.attr("placeholder")),void 0!==r){var n=o.is(":checked")?1:0;t[r]=n}}),o}return{inicializar:function(){var e=$.Deferred();return $(".contenedor-envio-mensajes[data-preload]").each(function(a,e){var o=$(this),r=o.attr("data-preload");void 0!==r&&0!=r.length&&$.ajax({type:"GET",url:r,contentType:"application/json; charset=utf-8"}).done(function(a){t(o,a)}).fail(function(a,e){moduloMenus.error()})}),$(".boton-envio-mensaje").on("click",function(){moduloActividad.on();var e=$(this),t=e.attr("data-url");void 0!==t&&0!=t.length||(t="/act/correo");var r=e.attr("data-once");r=void 0===r||0==r.length;var n=e.closest(".contenedor-envio-mensajes");if(n){n.find("[property='error']").remove(),n.find('[property="gracias"]').addClass("invisible");for(var i={},c=o(n,i),d=0,l=0;l<c.length;l++){var u=c[l];0!=u.error&&(a(n,u.msg,"error"),d++)}if(d>0)return void moduloActividad.off();$.ajax({type:"PUT",url:t,data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(e){0==e.error?(r&&n.children().addClass("invisible"),n.find('[property="gracias"]').removeClass("invisible")):a(n,e.msg,"error"),moduloActividad.off()}).fail(function(e,t){a(n,t,"error"),moduloActividad.off()})}}),e.resolve(),e.promise()}}}();if(!hayValor(moduloEdicion))var moduloEdicion=function(){var mapaIds={},activarEdicionOk=!1,MAX_FILE_SIZE=512e3,vie=null;try{vie=getVieHere()}catch(a){}var activarEdicion=function(){1!=activarEdicionOk&&"undefined"!=typeof Backbone&&(Backbone.sync=function(a,e,t){try{var o=e.toJSON(),r=o["@subject"];e.isNew()&&(r in mapaIds?o["@subject"]=mapaIds[r]:(o["@subject"]="<"+(new Date).getTime()+"_"+Math.floor(10*Math.random()+1)+">",mapaIds[r]=o["@subject"]));var n=o["@subject"],i=o["@type"],c=/(viejs\.org\/ns\/)(.*)(>)/g.exec(i),d=null;c&&(d=c[2]);var l=/(<)(.*)(>)/g,u=l.exec(n);if(null==u)return void t.error("error: no es identificador "+n);var s=u[2],f={};for(var p in o){var c=/(viejs\.org\/ns\/)(.*)(>)/g.exec(p);c&&(f[c[2]]=o[p])}var m={};switch(m.payload=f,m.leng=LENGUAJE,a){case"create":case"update":moduloActividad.on(),$.ajax({type:"PUT",url:"/rest/"+(null===d||void 0===d?"Documento":d)+"/"+s,data:JSON.stringify(m),contentType:"application/json; charset=utf-8"}).done(function(a){t.success(e)}).fail(function(a,e){t.error("error")}).always(function(){moduloActividad.off()})}}catch(a){t.error("error "+a)}},activarEdicionOk=!0)},activarPaginacion=function activarPaginacion(nodo){function activatePageA(actual){var cursor=actual.attr("data-next"),busqueda=JSON.parse(actual.attr("data-q")),template=actual.attr("data-tpl"),target=actual.attr("data-target"),ipage=parseInt(actual.attr("data-page"));busqueda.n||(busqueda.n=100),moduloApp.esAdmin()||actual.html(ipage*busqueda.n+1+" al "+(ipage+1)*busqueda.n),"1"===actual.attr("data-noa")&&(actual.removeAttr("href"),actual.on("click",function(){var docHtml=document.getElementById(template).innerHTML,destino=$(target),postload=destino.attr("data-postload");destino.length>0&&(moduloActividad.on(),$.ajax({type:"PUT",url:"/paginar/",data:JSON.stringify({busqueda:busqueda,cursor:cursor}),contentType:"application/json; charset=utf-8"}).done(function(msg){var datos=msg.datos,sigui=msg.next;destino.empty();for(var i=0;i<datos.length;i++){var dato=datos[i],nuevo=$(docHtml);llenarTemplate(nuevo,dato),destino.append(nuevo)}if(void 0!==sigui&&sigui.length>0){var padrePaginacion=actual.closest(".paginacion");if(0==padrePaginacion.find("[data-next='"+sigui+"']").length){for(var padreLocal=actual.parent(),nombreTAG=padreLocal.prop("tagName"),cambio=!1;padreLocal.get(0)!=padrePaginacion.get(0)&&"BODY"!=nombreTAG;)cambio=!0,actual=padreLocal,padreLocal=padreLocal.parent(),nombreTAG=padreLocal.prop("tagName");var paginaSigui=actual.clone(),paginaSigui2;paginaSigui2=cambio?paginaSigui.find("[data-next]"):paginaSigui,paginaSigui2.attr("data-page",ipage+1),paginaSigui2.attr("data-next",sigui),padrePaginacion.append(paginaSigui),activatePageA(paginaSigui2)}}void 0!==postload&&eval(postload)}).fail(function(a,e){moduloMenus.mostrarMenuSoloTexto("Error paginando")}).always(function(){moduloActividad.off()}))}))}hayValor(nodo)||(nodo=$("body")),$.each(nodo.find("a[data-next]"),function(a,e){activatePageA($(e))})},funcElegirBorrar=function(){var a=$(".btnEliminar");a.length>0?a.remove():$("[about]").each(function(a,e){var t=$(e),o=t.find(".btnEliminar");if(0==o.length){t.prepend($('<div class="btnEliminar"><div class="btnEliminarX btnEliminar2 manito"></div></div>')),o=t.find(".btnEliminar");o.find(".btnEliminar2").click(function(){var a=moduloMenus.confirmar();$.when(a).then(function(){var a=t,e=a.attr("about"),o=null;o=a.attr("typeof");var r=(hayValor(o)?o:"")+"_"+e;r in mapaIds&&(e=mapaIds[r]),moduloActividad.on(),$.ajax({type:"DELETE",url:"/rest/"+(hayValor(o)?o:"")+"/"+e}).done(function(e){a.remove(),$("body").data("Midgard-midgardNotifications").create({body:JSON.stringify(e)}),location.reload()}).fail(function(a,e){$("body").data("Midgard-midgardNotifications").create({body:TRADUCTOR.error_ajax[LENGUAJE]})}).always(function(){moduloActividad.off()}),moduloMenus.sacarUltimo()},function(){moduloMenus.sacarUltimo()})})}})},funcionAsignarPropiedadDeNodo=function(a,e,t,o,r){var n="[about='"+e+"'] [property='"+t+"']",i="[about='"+e+"'] [styleProperty='"+t+"'],[about='"+e+"'][styleProperty='"+t+"']";hayValor(r)||(r="");var c=function(){var n={};n[t+r]=o;var i=a.entities.get(e);i.set(n);var c=$("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(c,i)&&c.push(i),$("#midgardcreate-save").button({disabled:!1})},d=$(n),l=$(i);if(d.length>0){"IMG"==d.prop("tagName")&&("_alt"==r?d.attr("alt",o):d.attr("src",o)),c()}else l.length>0&&(o=o.replace(/"/g,"&quot;"),l.attr("style",o),c())},activarEstilosEditables=function(a){a.find("[styleProperty]").each(function(a,e){var t=$(e);if("ok"!==t.attr("act_style")){var o,r=t.attr("styleProperty");if(void 0===(o=void 0!==t.attr("about")?t:t.closest("[about]")))return;t.on("click",function(a){if(a.shiftKey){var e=t.attr("style");moduloMenus.mostrarFormularioEdicion(o.attr("about"),r,e)}else a.ctrlKey&&abrirFileChooser(t,r)}),t.attr("act_style","ok")}})},comunEdicionImagenes=function(a,e){var t={ok:!1};return"none"===$("#midgardcreate-save").css("display")?t:(void 0!==a.attr("about")?t.padre=a:t.padre=a.closest("[about]"),void 0===t.padre?t:(t.ident=t.padre.attr("about"),hayValor(e)?t.propiedad=e:t.propiedad=a.attr("property"),void 0===t.ident||void 0===t.propiedad?t:(t.ok=!0,t)))},abrirAltEditor=function(a){if("IMG"===a.prop("tagName")){var e=comunEdicionImagenes(a);0!=e.ok&&moduloMenus.mostrarFormularioEdicion(e.ident,e.propiedad,a.attr("alt"),"_alt")}},abrirFileChooser=function(a,e){var t=comunEdicionImagenes(a,e);if(0!=t.ok){var o=/(background-image\s*:\s*url\s*\(\s*['"]?)([^'^"]*?)(\s*['"]?\))\s*(!\s*important)?\s*(;)?/gi,r=function(t){var r="http://storage.googleapis.com"+t+"?"+(new Date).getTime();if(hayValor(e)){var n=a.attr("style");return n=n.replace(o,""),n=n.trim(),hayValor(n)&&!n.endsWith(";")&&(n+=";"),n+="background-image: url('"+r+"') !important;",a.attr("style",n),n}return a.attr("src",r),r},n=MAX_FILE_SIZE,i="/imagenesbasico";try{var c=a.attr("data-max");hayValor(c)&&(n=1024*parseInt(c))}catch(a){console.log("Intent칩 determinar tama침o m치ximo de imagen pero fall칩")}var d=a.attr("data-carpeta");"undefined"!==(void 0===d?"undefined":_typeof(d))&&!1!==d&&(d=d.trim(),hayValor(d)&&("/"!=d.charAt(0)&&(d="/"+d),i+=d));var l=moduloArchivos.subirArchivo({dataFolder:i,id:function(){var t=/^(https?:\/\/storage\.googleapis\.com)([^\?]*)(\?.*)?$/gi,r=null;if(hayValor(e)){var n=a.attr("style"),i=o.exec(n);null!=i&&i.length>3&&(r=i[2])}else r=a.attr("src");if(!hayValor(r))return null;var c=t.exec(r);return null!=c&&c.length>=3?c[2]:null}(),maximoTamanio:n});$.when(l).then(function(a){var e=r(a.id);funcionAsignarPropiedadDeNodo(vie,t.ident,t.propiedad,e)})}},activarImagenes=function(a){a.find("img[property]").each(function(a,e){var t=$(e);"ok"!==t.attr("act_img")&&($(e).on("click",function(a){var t=$(e);a.altKey?abrirAltEditor(t):abrirFileChooser(t)}),t.attr("act_img","ok"))})},activarEditables=function(a){a.find(".editable").each(function(a,e){var t=$(e);if("ok"!==t.attr("act_edt")&&(t.on("click",function(){var a=t.closest("[about]");if(a){if("none"===$("#midgardcreate-save").css("display"))return;moduloMenus.mostrarFormularioEdicion(a.attr("about"),t.attr("property"),t.html())}}),t.attr("act_edt","ok"),!t.hasClass("textarea_background"))){var o=$('<button type="button" style="padding: 5px !important;">editar</button>');o.bind("click",function(){t.click()}),t.after(o)}})},activarTextoPlano=function(a){a.find('[textplain="true"]').each(function(a,e){var t=$(e);"ok"!==t.attr("act_tpl")&&(t.on("blur",function(){t.html(t.text())}),t.attr("act_tpl","ok"))})},activarFechas=function(a){a.find("[dateProperty]").each(function(a,e){var t=$(e),o=t.attr("dateProperty");if("ok"!==t.attr("act_date")){var r=t.closest("[about]");if(r){var n=formatearFecha(t,"dd/MM/yyyy"),i=$('<input style="display: none;" class="datepicker" type="text" autofocuss value="'+n+'" data-valuee="'+n+'"></input>');r.append(i),t.click(function(){i.click()});var c=$('<div style="display: none;" property="'+o+'">'+t.attr("data-value")+"</div>");r.append(c),i.on("change",function(){var a=o,e={},n="0";try{n=parseInt(toDate(i.val()).getTime()/1e3)}catch(a){}e[a]=n;var d=vie.entities.get(r.attr("about"));d.set(e);var l=$("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(l,d)&&l.push(d),$("#midgardcreate-save").button({disabled:!1}),t.attr("data-value",n),c.text(n),formatearFecha(t)}),i.pickadate({format:"dd/mm/yyyy",formatSubmit:"dd/mm/yyyy",closeOnSelect:!0,closeOnClear:!0,selectMonths:!0,selectYears:!0})}t.attr("act_date","ok")}})},inicializar=function(){var a=$.Deferred();activarEdicion(),activarPaginacion(),$("body").append($('<input type=\'file\' id="formularioImagenes" class="fileEscondido" nodo2="" property2="" />')),$("body").append($('<div class="formhtml invisible">\t<div class="ctrles"><a class="guardar">Guardar</a>&nbsp;<a class="cancelar">Cancelar</a></div>\t<div class="boxtexto">\t<textarea></textarea>\t</div></div>')),activarEstilosEditables($("body")),activarImagenes($("body")),activarEditables($("body")),activarTextoPlano($("body")),activarFechas($("body")),$("body").bind("midgardeditableenable",function(a,e){var t=e.entity["@subject"],o=/(<)(.*)(>)/g,r=o.exec(t);r=r?r[2]:t;var n=$("[about='"+r+"']");void 0!==n&&(activarEstilosEditables(n),activarImagenes(n),activarEditables(n),activarTextoPlano(n),activarFechas(n))}),$("body").midgardCreate({url:function(){return"javascript:false;"},vie:vie,highlight:!1,collectionWidgets:{default:"midgardCollectionAdd"}}),configureEditorsHere();return $(".formhtml .cancelar").click(function(){$(".formhtml").addClass("invisible")}),$(".formhtml .guardar").click(function(){try{var a=$(".formhtml"),e=a.attr("nodo2"),t=a.attr("property2"),o=a.attr("sufijo"),r=$(".formhtml textarea").val();funcionAsignarPropiedadDeNodo(vie,e,t,r,o),$(".formhtml").addClass("invisible")}catch(a){$("body").data("Midgard-midgardNotifications").create({body:"Error "+a})}}),$("#formularioImagenes").change(function(){if(this.files&&this.files[0]){var a=new FileReader;a.onload=function(a){var e=$("#formularioImagenes"),t=e.attr("nodo2"),o=e.attr("property2"),r=$("[about='"+t+"'] [property='"+o+"']"),n={};if(n[o]=a.target.result,r){"IMG"==r.prop("tagName")?r.attr("src",a.target.result):r.attr("style","background-image: url('"+a.target.result+"') !important");var i=vie.entities.get(t);i.set(n);var c=$("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(c,i)&&c.push(i),$("#midgardcreate-save").button({disabled:!1})}},a.readAsDataURL(this.files[0])}}),$("textarea[property]").on("change keyup paste",function(){self=$(this);var a=self.attr("property"),e=self.closest("[about]");if(e){var t=e.attr("about"),o=self.val(),r={};r[a]=o;var n=vie.entities.get(t);n.set(r);var i=$("body").data("Midgard-midgardStorage").changedModels;-1===_.indexOf(i,n)&&i.push(n),$("#midgardcreate-save").button({disabled:!1})}}),a.promise()};return{inicializar:inicializar,activarPaginacion:activarPaginacion,activarEdicion:activarEdicion,funcElegirBorrar:funcElegirBorrar}}();if(!hayValor(moduloMenus))var moduloMenus=function(){var a=[],e=function(a){return moduloHttp.get("/assets/cmgae/menus"+a)},t=function(e){return 0!=a.length&&a[a.length-1].id==e},o=function(){if(0!=a.length){a[a.length-1].nodo.remove(),a.pop()}},r=function(a){var t=e("/soloTexto.html");$.when(t).then(function(e){l("alerta",e,{html:{".mensaje_texto":a}})})},n=function(){r(moduloLocal.traducir("menus.mensajes.error"))},i=function(a){$.when(a).then(function(){r(moduloLocal.traducir("menus.mensajes.hecho"))},n)},c=function(a,e){moduloLocal.procesarElemento(a);var t={funciones:{".menu_opc_ingresar":moduloApp.login,".menu_opc_salir":moduloApp.logout,".menu_opc_borrar_cache":moduloApp.borrarCache,".create-ui-toggle2":moduloApp.abrirBarraEdicion,".menuEliminar":moduloEdicion.funcElegirBorrar},html:{},botones:{}};if(t=$.extend(t,e),$.each(t.funciones,function(e,t){a.find(e).on("click",function(){o();var a=t();hayValor(a)&&i(a)})}),esObjeto(t.botones)){var r=$('<div class="row"><div class="col-xs-12"><div class="text-right botones-aca"></div></div></div>'),n={texto:"?",clase:"btn-primary",accion:function(){}};$.each(t.botones,function(a,e){predefinir(e,n);var t=$('<button type="button" class="btn btn-xs"></button>');t.on("click",e.accion),t.addClass(e.clase),t.text(e.texto),r.find(".botones-aca").append(t)}),a.append(r)}for(var c in t.html)a.find(c).html(t.html[c])},d=function(){var a=e("/confirmar.html"),t=$.Deferred();return $.when(a).then(function(a){var e={botones:{aceptar:{texto:moduloLocal.traducir("menus.botones.aceptar"),clase:"btn-success",accion:function(){t.resolve()}},cancelar:{texto:moduloLocal.traducir("menus.botones.cancelar"),clase:"btn-danger",accion:function(){t.reject()}}}};l("confirmacion",a,e)}),t.promise()},l=function(e,t,o){var r=$(t);$("body").append(r),a.push({id:e,nodo:r}),c(r,o)},u=function(){var a=$.Deferred();if(t("menu"))return o(),a.reject(),a.promise();var r=null;return r=e(moduloApp.esUsuario()?moduloApp.esAdmin()?"/menuInicialAdmin.html":"/menuInicialAnonimo.html":"/menuInicialAnonimo.html"),$.when(r).then(function(e){l("menu",e),a.resolve()}),a.promise()},s=function(){pila.push("menu_pagina"),$(".menu_core").toggleClass("invisible"),$(".menu_pagina").toggleClass("invisible"),window.scrollTo(0,0)},f=function(a,e,t,o){pila.push("formhtml"),$(".formhtml").attr("nodo2",a),$(".formhtml").attr("property2",e),$(".formhtml").attr("sufijo",o),$(".formhtml textarea").val(t),$(".formhtml").removeClass("invisible")};return{inicializar:function(){var e=$.Deferred();return $(document).keyup(function(e){27==e.keyCode&&(0==a.length?u():o())}),e.resolve(),e.promise()},mostrarMenuPagina:s,mostrarFormularioEdicion:f,mostrarMenuBasico:u,mostrarMenuSoloTexto:r,confirmar:d,sacarUltimo:o,error:n}}();