function configurarListasEditor(t,r){t.use(new t.RdfaService);for(var o in r){for(var a=o+"Rel",e=r[o],n=[],i=0;i<e.campos.length;i++){var c=e.campos[i];n.push({id:c.nombre,range:c.tipo,min:0,max:1})}t.types.add(o,n);for(var f=0;f<e.listas.length;f++){var l=e.listas[f];t.types.add(l.nombre,[{id:a,range:o,min:0,max:-1}])}t.service("rdfa").setTemplate(o,a,jQuery(e.ejemplo).html())}}function tieneAtributo(t,r){var o=t.attr(r);return"undefined"!==(void 0===o?"undefined":_typeof(o))&&!1!==o}function borrarLocalStorage(){localStorage.removeItem(LLAVE_CARRITO),localStorage.removeItem(LLAVE_PRODS_CARR)}function postLogin(){borrarLocalStorage()}function postLogout(){borrarLocalStorage()}function waitOn(){$("#loadingDiv").removeClass("invisible")}function waitOff(){$("#loadingDiv").addClass("invisible")}function toDate(t){var r=t.split("/");return new Date(r[2],r[1]-1,r[0])}function formatearFecha(t,r){var o=t.attr("data-value");if(o){var a=new Date(0);try{a.setUTCSeconds(parseInt(o))}catch(t){}if(t.find("[data-format]").each(function(t,r){var o=$(r),e=o.attr("data-format"),n=$.format.date(a.getTime(),e);o.text(n)}),void 0!==r)return $.format.date(a.getTime(),r)}return""}function darValorFechaFormateado(t){}function formatearFechaElem(t){t.find("[dateProperty]").each(function(t,r){formatearFecha($(r))})}function llenarTemplate(t,r){t.find("[property]").each(function(t,o){var a=$(o),e=a.attr("property"),n=e+"_"+LENGUAJE,i=r[n],c=r[e],f=i;void 0===f&&(f=c),void 0!==f&&("IMG"==a.prop("tagName")?a.attr("src",f):a.html(f))}),t.find("[dateProperty]").each(function(t,o){var a=$(o),e=a.attr("dateProperty"),n=r[e];void 0!==n&&a.attr("data-value",n)}),formatearFechaElem(t)}function mostrarMensaje(t,r,o){var a="div",e=t.prop("tagName");"UL"!=e&&"OL"!=e||(a="li");var n=$("<"+a+' property="'+o+'" class="'+o+'"></'+a+">");n.text(r),t.prepend(n)}function escorrecto(t){var r=t.attr("validacion"),o=t.attr("placeholder");if(void 0===o&&(o=t.attr("name")),void 0!==r){void 0===o&&(o=r);var a=new RegExp(r,"gi");if(!t.val().match(a))return{error:1,msg:TRADUCTOR.verif_campo[LENGUAJE]+o}}return{error:0}}function llenarCampos(t,r){t.find("input[type=text],select,textarea").each(function(t,o){var a=$(o),e=a.attr("name");void 0===e&&(e=a.attr("placeholder")),e in r&&a.val(r[e])}),t.find("input[type=checkbox]").each(function(t,o){var a=$(o),e=a.attr("name");void 0===e&&(e=a.attr("placeholder")),e in r&&(1==r[e]?a.prop("checked",!0):a.prop("checked",!1))}),t.find("input[type=radio]").each(function(t,o){var a=$(o),e=a.attr("name");void 0===e&&(e=a.attr("placeholder")),e in r&&(r[e]==a.attr("value")?a.prop("checked",!0):a.prop("checked",!1))})}function capturarFormulario(t,r){var o=[];return t.find("input[type=text],textarea").each(function(t,r){var a=$(r),e=escorrecto(a);o.push(e)}),t.find("input[type=text],select,textarea,input[type=radio]:checked").each(function(t,o){var a=$(o),e=a.attr("name");if(void 0===e&&(e=a.attr("placeholder")),void 0!==e){var n=a.val();r[e]=n}}),t.find("input[type=checkbox]").each(function(t,o){var a=$(o),e=a.attr("name");if(void 0===e&&(e=a.attr("placeholder")),void 0!==e){var n=a.is(":checked")?1:0;r[e]=n}}),o}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},LLAVE_CARRITO="CARRITO_LOCAL",LLAVE_PRODS_CARR="TEMP_PRODS",TRADUCTOR={verif_campo:{esp:"Verifique el campo ",eng:"Verify the field "},cache_borr_ok:{esp:"Cache borrada!",eng:"Erased cache!"},error_ajax:{esp:"Error al invocar ajax",eng:"Ajax invocation error"}};!0!==HAS_USER&&borrarLocalStorage(),formatearFechaElem($("body")),function(t){function r(r,o,e){a(function(r){t.ajax({type:"PUT",url:"/carrito/",data:JSON.stringify(r),contentType:"application/json; charset=utf-8"}).done(function(t){o()}).fail(function(t,r){e("Error guardando carrito:"+r)})},function(t){e("error leyendo carrito:"+t)})}function o(t){var r=LLAVE_CARRITO;localStorage[r]=JSON.stringify(t)}function a(r,o){try{var a=localStorage[LLAVE_CARRITO],e=void 0;if(void 0!==a)try{e=JSON.parse(a)}catch(t){}void 0===a||void 0!==a&&void 0===e?t.ajax({type:"GET",url:"/carrito/",contentType:"application/json; charset=utf-8"}).done(function(t){try{JSON.parse(t.json),a=t.json}catch(t){a="{}"}localStorage[LLAVE_CARRITO]=a,e=JSON.parse(a),r(e)}).fail(function(t,r){o(r)}):r(e)}catch(t){o(t)}}function e(t){waitOn(),a(function(r){t in r&&(delete r[t],o(r)),waitOff()},function(t){console.log("error leyendo carrito:"+t),waitOff()})}function n(t){waitOn(),a(function(r){t in r||(r[t]={},o(r)),f(void 0,[t],function(){waitOff()},function(){console.log("error completando productos de carrito")})},function(t){console.log("error leyendo carrito:"+t),waitOff()})}function i(){var t=localStorage[LLAVE_PRODS_CARR];return void 0===t&&(t="{}"),JSON.parse(t)}function c(t){localStorage[LLAVE_PRODS_CARR]=JSON.stringify(t)}function f(r,o,a,e){function n(r,o){r.find("[about][typeof]").each(function(r,a){var e=t(a),n=e.attr("typeof")+"/"+e.attr("about");n in o&&llenarTemplate(e,o[n])})}0==o.length?(void 0!==r&&n(r,u),a()):t.ajax({type:"PUT",url:"/productos/",contentType:"application/json; charset=utf-8",data:JSON.stringify(o)}).done(function(t){if(0==t.error){var o=t.data;for(var i in o)u[i]=o[i];c(u),void 0!==r&&n(r,u),a()}else e()}).fail(function(t,r){e()})}function l(r,o,a){try{var e=[],n=i();r.find("[about][typeof]").each(function(r,o){var a=t(o),i=a.attr("typeof")+"/"+a.attr("about");i in n||e.push(i)}),f(r,e,o,a)}catch(t){console.log(t)}}var u={};t(".contenedor-envio-mensajes[data-preload]").each(function(r,o){var a=t(this),e=a.attr("data-preload");void 0!==e&&0!=e.length&&t.ajax({type:"GET",url:e,contentType:"application/json; charset=utf-8"}).done(function(t){llenarCampos(a,t)}).fail(function(t,r){console.log("Error precargando "+e)})}),t(".boton-envio-mensaje").on("click",function(){waitOn();var r=t(this),o=r.attr("data-url");void 0!==o&&0!=o.length||(o="/act/correo");var a=r.attr("data-once");a=void 0===a||0==a.length;var e=r.closest(".contenedor-envio-mensajes");if(e){e.find("[property='error']").remove(),e.find('[property="gracias"]').addClass("invisible");for(var n={},i=capturarFormulario(e,n),c=0,f=0;f<i.length;f++){var l=i[f];0!=l.error&&(mostrarMensaje(e,l.msg,"error"),c++)}if(c>0)return void waitOff();t.ajax({type:"PUT",url:o,data:JSON.stringify(n),contentType:"application/json; charset=utf-8"}).done(function(t){0==t.error?(a&&e.children().addClass("invisible"),e.find('[property="gracias"]').removeClass("invisible")):mostrarMensaje(e,t.msg,"error"),waitOff()}).fail(function(t,r){mostrarMensaje(e,r,"error"),waitOff()})}}),!0===HAS_USER&&function(){var r=t("#listaCarrito");if(void 0!==r){waitOn();try{r.empty(),a(function(o){for(var a in o){var n=a.split(/\/(.+)?/),i=n[0],c=n[1],f="Carrito"+i,u=document.getElementById(f);if(void 0===u||null===u)return void waitOff();var d=t(u.innerHTML);d.attr("about",c),llenarCampos(d,o[a]),d.find(".carrito_borrar").click(function(){var r=t(this),o=r.closest("[about]");o&&(e(o.attr("typeof")+"/"+o.attr("about")),o.remove())}),r.append(d)}l(r,function(){waitOff()},function(){waitOff()})},function(t){console.log("error leyendo carrito:"+t),waitOff()})}catch(t){console.log("error cargando lista carrito:"+t)}}}(),t(".carrito_guardar_remoto").click(function(){var e=t("#listaCarrito");if(void 0===e)return void console.log("No se encontro #listaCarrito");waitOn(),a(function(a){try{var n=0;if(e.children().each(function(r,o){var e=t(o),i=e.attr("about"),c=e.attr("typeof"),f=c+"/"+i;f in a||(a[f]={});for(var l=capturarFormulario(e,a[f]),u=0;u<l.length;u++){var d=l[u];0!=d.error&&(mostrarMensaje(e,d.msg,"error"),n++)}}),n>0)return void waitOff();o(a),r(a,function(){waitOff()},function(t){console.log("error guardando carrito:"+t),waitOff()})}catch(t){console.log("error procesando elementos de carrito:"+t)}},function(t){console.log("error leyendo carrito:"+t),waitOff()})}),t("[data-producto]").each(function(r,o){var a=t(this),e=a.closest("[about]");if(e){var i=e.attr("typeof"),c=e.attr("about");void 0!==i&&0!=i.length||(i=""),a.on("click",function(){n(i+"/"+c)})}}),t("[data-lenguaje]").each(function(r,o){var a=t(this),e=a.attr("data-lenguaje");a.on("click",function(){var t=/(http)(s?)(:)(\/\/)(.*?)(\/)((leng-)(.*?)(\/))?(.*)/g.exec(window.location);if(t){for(var r="",o=!0,a=t[9],n=e===LENGUAJE_PRED,i=1;i<t.length;i++){var c=t[i];if(i<=6||i>=11)void 0!==c&&(r+=c);else{if(n){if(void 0===a)return}else if(a===e)return;!n&&o&&(r+="leng-"+e+"/",o=!1)}}window.location=r}})}),t(".mycountdown").each(function(r,o){var a=t(o),e=a.text(),n=a.attr("data-count-format");a.countdown(e,function(r){t(this).text(r.strftime(n))})})}(jQuery);