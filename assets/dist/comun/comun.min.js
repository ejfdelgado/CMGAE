var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},hayValor=function(a){return void 0!=a&&null!=a&&(!("string"==typeof a)||a.trim().length>0)},esFuncion=function(a){return"function"==typeof a},esNumero=function(a){return"number"==typeof a||/^\d+$/.test(a)},esBoolean=function(a){return"boolean"==typeof a},esObjeto=function(a){return"object"==(void 0===a?"undefined":_typeof(a))&&null!==a},esLista=function(a){return hayValor(a)&&a instanceof Array},esMultilenguaje=function(a){return/^(\S)+(\.\S+)+$/gim.test(a)},leerObj=function(a,o,n){if(!hayValor(o)||!esObjeto(a))return n;for(var i=o.split("."),t=a,e=0;e<i.length;e++){var r=i[e];if(esNumero(r)&&esLista(t)&&(r=parseInt(r)),t=t[r],e!=i.length-1&&!esObjeto(t))return n}return hayValor(t)?esFuncion(t)?t():t:n};if(!hayValor(moduloActividad))var moduloActividad=function(){var a=0;return{on:function(o){if(hayValor(o)||(o=""),0==a){var n=$('<div id="loading"><p></p></div>');n.find("p").html(o),$("body").append(n)}a++},off:function(){--a<=0&&(a=0,$("#loading").remove())}}}();if(!hayValor(moduloHttp))var moduloHttp=function(){return{get:function(a){var o=$.Deferred();return moduloActividad.on(),$.ajax({url:a,type:"GET",cache:!1}).done(function(a){o.resolve(a)}).fail(function(){o.reject()}).always(function(){moduloActividad.off()}),o.promise()}}}();if(!hayValor(moduloLocal))var moduloLocal=function(){var a={lengua:LENGUAJE},o=null,n=function(a){return esObjeto(o)?leerObj(o,a,a):a},i=function(a){$.each(a.find(".traducir"),function(a,o){var i=$(o),t=i.text();if(esMultilenguaje(t)){var e=n(t);e!=t&&i.html(e)}})};return function(){var n=moduloHttp.get("/assets/cmgae/local/"+a.lengua+".json");$.when(n).then(function(a){o=JSON.parse(a)})}(),{traducir:n,procesarElemento:i}}();if(!hayValor(moduloApp))var moduloApp=function(){var a={URL_LOGIN:URL_LOGIN,URL_LOGOUT:URL_LOGOUT,HAS_USER:HAS_USER,IS_ADMIN:IS_ADMIN},o=function(){return a.IS_ADMIN},n=function(){return a.HAS_USER},i=function(){window.location.href=a.URL_LOGIN},t=function(){window.location.href=a.URL_LOGOUT},e=function(){"full"===$("body").data("Midgard-midgardToolbar").options.display?($("body").data("Midgard-midgardToolbar").__proto__.hide(),$("body").data("Midgard-midgardToolbar").options.display="minimized"):($("body").data("Midgard-midgardToolbar").__proto__.show(),$("body").data("Midgard-midgardToolbar").options.display="full")};return{esAdmin:o,esUsuario:n,login:i,logout:t,borrarCache:function(){var a=$.Deferred();return moduloActividad.on(),$.ajax({type:"GET",url:"/act/clearmemcache",data:JSON.stringify({}),contentType:"application/json; charset=utf-8"}).done(function(o){a.resolve()}).fail(function(o,n){a.reject()}).always(function(){moduloActividad.off()}),a.promise()},abrirBarraEdicion:e}}();if(!hayValor(moduloMenus))var moduloMenus=function(){var a=[],o=function(a){return moduloHttp.get("/assets/cmgae/menus"+a)},n=function(o){return 0!=a.length&&a[a.length-1].id==o},i=function(){if(0!=a.length){a[a.length-1].nodo.remove(),a.pop()}},t=function(a){var n=o("/soloTexto.html");$.when(n).then(function(o){l("alerta",o,{html:{".mensaje_texto":a}})})},e=function(a){$.when(a).then(function(){t("Hecho!")},function(){t("Error :(")})},r=function(a,o){moduloLocal.procesarElemento(a);var n={funciones:{".menu_opc_ingresar":moduloApp.login,".menu_opc_salir":moduloApp.logout,".menu_opc_borrar_cache":moduloApp.borrarCache,".create-ui-toggle2":moduloApp.abrirBarraEdicion,".menuEliminar":moduloEdicion.funcElegirBorrar},html:{}};n=$.extend(n,o),$.each(n.funciones,function(o,n){a.find(o).on("click",function(){i();var a=n();hayValor(a)&&e(a)})});for(var t in n.html)a.find(t).html(n.html[t])},l=function(o,n,i){var t=$(n);$("body").append(t),a.push({id:o,nodo:t}),r(t,i)},u=function(){var a=$.Deferred();if(n("menu"))return i(),a.reject(),a.promise();var t=null;return t=o(moduloApp.esUsuario()?moduloApp.esAdmin()?"/menuInicialAdmin.html":"/menuInicialAnonimo.html":"/menuInicialAnonimo.html"),$.when(t).then(function(o){l("menu",o),a.resolve()}),a.promise()},c=function(){pila.push("menu_pagina"),$(".menu_core").toggleClass("invisible"),$(".menu_pagina").toggleClass("invisible"),window.scrollTo(0,0)},d=function(a,o,n,i){pila.push("formhtml"),console.log("mostrarFormularioEdicion",a,o,n),$(".formhtml").attr("nodo2",a),$(".formhtml").attr("property2",o),$(".formhtml").attr("sufijo",i),$(".formhtml textarea").val(n),$(".formhtml").removeClass("invisible")};return $(document).keyup(function(o){27==o.keyCode&&(0==a.length?u():i())}),{mostrarMenuPagina:c,mostrarFormularioEdicion:d,mostrarMenuBasico:u,mostrarMenuSoloTexto:t}}();if(!hayValor(moduloEdicion))var moduloEdicion=function(){var mapaIds={},activarEdicionOk=!1,activarEdicion=function(){1!=activarEdicionOk&&"undefined"!=typeof Backbone&&(Backbone.sync=function(a,o,n){try{var i=o.toJSON(),t=i["@subject"];o.isNew()&&(t in mapaIds?i["@subject"]=mapaIds[t]:(i["@subject"]="<"+(new Date).getTime()+"_"+Math.floor(10*Math.random()+1)+">",mapaIds[t]=i["@subject"]));var e=i["@subject"],r=i["@type"],l=/(viejs\.org\/ns\/)(.*)(>)/g.exec(r),u=null;l&&(u=l[2]);var c=/(<)(.*)(>)/g,d=c.exec(e);if(null==d)return void n.error("error: no es identificador "+e);var s=d[2],f={};for(var m in i){var l=/(viejs\.org\/ns\/)(.*)(>)/g.exec(m);l&&(f[l[2]]=i[m])}var p={};switch(p.payload=f,p.leng=LENGUAJE,a){case"create":case"update":moduloActividad.on(),$.ajax({type:"PUT",url:"/rest/"+(null===u||void 0===u?"Documento":u)+"/"+s,data:JSON.stringify(p),contentType:"application/json; charset=utf-8"}).done(function(a){n.success(o)}).fail(function(a,o){n.error("error")}).always(function(){moduloActividad.off()})}}catch(a){n.error("error "+a)}},activarEdicionOk=!0)},activarPaginacion=function activarPaginacion(nodo){function activatePageA(actual){var cursor=actual.attr("data-next"),busqueda=JSON.parse(actual.attr("data-q")),template=actual.attr("data-tpl"),target=actual.attr("data-target"),ipage=parseInt(actual.attr("data-page"));busqueda.n||(busqueda.n=100),moduloApp.esAdmin()||actual.html(ipage*busqueda.n+1+" al "+(ipage+1)*busqueda.n),"1"===actual.attr("data-noa")&&(actual.removeAttr("href"),actual.on("click",function(){var docHtml=document.getElementById(template).innerHTML,destino=$(target),postload=destino.attr("data-postload");destino.length>0&&(moduloActividad.on(),$.ajax({type:"PUT",url:"/paginar/",data:JSON.stringify({busqueda:busqueda,cursor:cursor}),contentType:"application/json; charset=utf-8"}).done(function(msg){var datos=msg.datos,sigui=msg.next;destino.empty();for(var i=0;i<datos.length;i++){var dato=datos[i],nuevo=$(docHtml);llenarTemplate(nuevo,dato),destino.append(nuevo)}if(void 0!==sigui&&sigui.length>0){var padrePaginacion=actual.closest(".paginacion");if(0==padrePaginacion.find("[data-next='"+sigui+"']").length){for(var padreLocal=actual.parent(),nombreTAG=padreLocal.prop("tagName"),cambio=!1;padreLocal.get(0)!=padrePaginacion.get(0)&&"BODY"!=nombreTAG;)cambio=!0,actual=padreLocal,padreLocal=padreLocal.parent(),nombreTAG=padreLocal.prop("tagName");var paginaSigui=actual.clone(),paginaSigui2;paginaSigui2=cambio?paginaSigui.find("[data-next]"):paginaSigui,paginaSigui2.attr("data-page",ipage+1),paginaSigui2.attr("data-next",sigui),padrePaginacion.append(paginaSigui),activatePageA(paginaSigui2)}}void 0!==postload&&eval(postload)}).fail(function(a,o){moduloMenus.mostrarMenuSoloTexto("Error paginando")}).always(function(){moduloActividad.off()}))}))}hayValor(nodo)||(nodo=$("body")),$.each(nodo.find("a[data-next]"),function(a,o){activatePageA($(o))})},funcElegirBorrar=function(){var a=$(".btnEliminar");a.length>0?a.remove():$("[about]").each(function(a){var o=$(this),n=o.find(".btnEliminar");if(0==n.length){o.prepend($('<div class="btnEliminar"><div class="btnEliminarX btnEliminar2 manito"></div><div class="btnEliminarX opciones invisible">\t<div class="btnEliminar3"></div>\t<div class="btnEliminar4 manito">Cancelar</div>\t<div class="btnEliminar5 manito">Aceptar</div></div></div>')),n=o.find(".btnEliminar");var i=n.find(".btnEliminar2"),t=n.find(".btnEliminar4"),e=n.find(".btnEliminar5");i.click(function(){var a=$(this);a.addClass("invisible"),a.siblings(".opciones").removeClass("invisible")}),e.click(function(){var a=$(this),o=a.closest("[about]");if(o.length>0){var n=o.attr("about"),i=null;i=o.attr("typeof");var t=(null===i||void 0===i?"":i)+"_"+n;t in mapaIds&&(n=mapaIds[t]),moduloActividad.on(),$.ajax({type:"DELETE",url:"/rest/"+(null===i||void 0===i?"":i)+"/"+n}).done(function(a){o.remove(),$("body").data("Midgard-midgardNotifications").create({body:JSON.stringify(a)}),location.reload()}).fail(function(a,o){$("body").data("Midgard-midgardNotifications").create({body:TRADUCTOR.error_ajax[LENGUAJE]})}).always(function(){moduloActividad.off()})}}),t.click(function(){var a=$(this);a.closest(".opciones").addClass("invisible"),a.closest(".btnEliminar").find(".btnEliminar2").removeClass("invisible")})}}),"menu"===pila[pila.length-1]&&pila.pop()};return activarPaginacion(),{activarPaginacion:activarPaginacion,activarEdicion:activarEdicion,funcElegirBorrar:funcElegirBorrar}}();var pila=[];!function(a){moduloEdicion.activarEdicion()}(jQuery);