var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},hayValor=function(a){return void 0!=a&&null!=a&&(!("string"==typeof a)||a.trim().length>0)},esFuncion=function(a){return"function"==typeof a},esNumero=function(a){return"number"==typeof a||/^\d+$/.test(a)},esBoolean=function(a){return"boolean"==typeof a},esObjeto=function(a){return"object"==(void 0===a?"undefined":_typeof(a))&&null!==a},esLista=function(a){return hayValor(a)&&a instanceof Array},esMultilenguaje=function(a){return/^(\S)+(\.\S+)+$/gim.test(a)},leerObj=function(a,o,n,t){if(!hayValor(o)||!esObjeto(a))return n;for(var i=o.split("."),e=a,r=0;r<i.length;r++){var u=i[r];if(esNumero(u)&&esLista(e)&&(u=parseInt(u)),e=e[u],r!=i.length-1&&!esObjeto(e))return n}return hayValor(e)?!0!==t&&esFuncion(e)?e():e:n},asignarObj=function(a,o,n){for(var t=o.split("."),i=a,e=0;e<t.length;e++){var r=t[e];esNumero(r)&&(r=parseInt(r)),esObjeto(i)&&(e==t.length-1?esLista(i[r])&&esLista(n)&&i[r]!==n?(i[r].splice(0,i[r].length),$.each(n,function(a,o){i[r].push(o)})):i[r]=n:((Object.keys(i).indexOf(""+r)<0||null==i[r])&&(esNumero(t[e+1])?i[r]=[]:i[r]={}),i=i[r]))}},darRutasObjeto=function(a,o){var n=[];return function a(t,i){esObjeto(t)?$.each(t,function(t,e){var r=null;r=null===i?t:i+"."+t,esFuncion(o)&&o(e)&&n.push(r),a(e,r)}):null!==i&&(esFuncion(o)?o(t)&&n.push(i):n.push(i))}(a,null),n},predefinir=function(a,o){for(var n=darRutasObjeto(o),t=0;t<n.length;t++){var i=n[t];if(!hayValor(leerObj(a,i,null,!0))){var e=leerObj(o,i,null,!0);asignarObj(a,i,e)}}return a};if(!hayValor(moduloActividad))var moduloActividad=function(){var a=0;return{on:function(o){if(hayValor(o)||(o=""),0==a){var n=$('<div id="loading"><p></p></div>');n.find("p").html(o),$("body").append(n)}a++},off:function(){--a<=0&&(a=0,$("#loading").remove())}}}();if(!hayValor(moduloHttp))var moduloHttp=function(){return{get:function(a){var o=$.Deferred();return moduloActividad.on(),$.ajax({url:a,type:"GET",cache:!1}).done(function(a){o.resolve(a)}).fail(function(){o.reject()}).always(function(){moduloActividad.off()}),o.promise()}}}();if(!hayValor(moduloLocal))var moduloLocal=function(){var a={lengua:LENGUAJE},o=null,n=function(a){return esObjeto(o)?leerObj(o,a,a):a},t=function(a){$.each(a.find(".traducir"),function(a,o){var t=$(o),i=t.text();if(esMultilenguaje(i)){var e=n(i);e!=i&&t.html(e)}})};return function(){var n=moduloHttp.get("/assets/cmgae/local/"+a.lengua+".json");$.when(n).then(function(a){o=JSON.parse(a)})}(),{traducir:n,procesarElemento:t}}();if(!hayValor(moduloApp))var moduloApp=function(){var a={URL_LOGIN:URL_LOGIN,URL_LOGOUT:URL_LOGOUT,HAS_USER:HAS_USER,IS_ADMIN:IS_ADMIN},o=function(){return a.IS_ADMIN},n=function(){return a.HAS_USER},t=function(){moduloActividad.on(),window.location.href=a.URL_LOGIN},i=function(){moduloActividad.on(),window.location.href=a.URL_LOGOUT},e=function(){"full"===$("body").data("Midgard-midgardToolbar").options.display?($("body").data("Midgard-midgardToolbar").__proto__.hide(),$("body").data("Midgard-midgardToolbar").options.display="minimized"):($("body").data("Midgard-midgardToolbar").__proto__.show(),$("body").data("Midgard-midgardToolbar").options.display="full")};return{esAdmin:o,esUsuario:n,login:t,logout:i,borrarCache:function(){var a=$.Deferred();return moduloActividad.on(),$.ajax({type:"GET",url:"/act/clearmemcache",data:JSON.stringify({}),contentType:"application/json; charset=utf-8"}).done(function(o){a.resolve()}).fail(function(o,n){a.reject()}).always(function(){moduloActividad.off()}),a.promise()},abrirBarraEdicion:e}}();if(!hayValor(moduloMenus))var moduloMenus=function(){var a=[],o=function(a){return moduloHttp.get("/assets/cmgae/menus"+a)},n=function(o){return 0!=a.length&&a[a.length-1].id==o},t=function(){if(0!=a.length){a[a.length-1].nodo.remove(),a.pop()}},i=function(a){var n=o("/soloTexto.html");$.when(n).then(function(o){l("alerta",o,{html:{".mensaje_texto":a}})})},e=function(){i(moduloLocal.traductir("menus.mensajes.error"))},r=function(a){$.when(a).then(function(){i(moduloLocal.traductir("menus.mensajes.hecho"))},e)},u=function(a,o){moduloLocal.procesarElemento(a);var n={funciones:{".menu_opc_ingresar":moduloApp.login,".menu_opc_salir":moduloApp.logout,".menu_opc_borrar_cache":moduloApp.borrarCache,".create-ui-toggle2":moduloApp.abrirBarraEdicion,".menuEliminar":moduloEdicion.funcElegirBorrar},html:{},botones:{}};if(n=$.extend(n,o),$.each(n.funciones,function(o,n){a.find(o).on("click",function(){t();var a=n();hayValor(a)&&r(a)})}),esObjeto(n.botones)){var i=$('<div class="row"><div class="col-xs-12"><div class="text-right botones-aca"></div></div></div>'),e={texto:"?",clase:"btn-primary",accion:function(){}};$.each(n.botones,function(a,o){predefinir(o,e);var n=$('<button type="button" class="btn btn-xs"></button>');n.on("click",o.accion),n.addClass(o.clase),n.text(o.texto),i.find(".botones-aca").append(n)}),a.append(i)}for(var u in n.html)a.find(u).html(n.html[u])},c=function(){var a=o("/confirmar.html"),n=$.Deferred();return $.when(a).then(function(a){var o={botones:{aceptar:{texto:moduloLocal.traducir("menus.botones.aceptar"),clase:"btn-success",accion:function(){n.resolve()}},cancelar:{texto:moduloLocal.traducir("menus.botones.cancelar"),clase:"btn-danger",accion:function(){n.reject()}}}};l("confirmacion",a,o)}),n.promise()},l=function(o,n,t){var i=$(n);$("body").append(i),a.push({id:o,nodo:i}),u(i,t)},d=function(){var a=$.Deferred();if(n("menu"))return t(),a.reject(),a.promise();var i=null;return i=o(moduloApp.esUsuario()?moduloApp.esAdmin()?"/menuInicialAdmin.html":"/menuInicialAnonimo.html":"/menuInicialAnonimo.html"),$.when(i).then(function(o){l("menu",o),a.resolve()}),a.promise()},s=function(){pila.push("menu_pagina"),$(".menu_core").toggleClass("invisible"),$(".menu_pagina").toggleClass("invisible"),window.scrollTo(0,0)},f=function(a,o,n,t){pila.push("formhtml"),console.log("mostrarFormularioEdicion",a,o,n),$(".formhtml").attr("nodo2",a),$(".formhtml").attr("property2",o),$(".formhtml").attr("sufijo",t),$(".formhtml textarea").val(n),$(".formhtml").removeClass("invisible")};return $(document).keyup(function(o){27==o.keyCode&&(0==a.length?d():t())}),{mostrarMenuPagina:s,mostrarFormularioEdicion:f,mostrarMenuBasico:d,mostrarMenuSoloTexto:i,confirmar:c,sacarUltimo:t,error:e}}();if(!hayValor(moduloEdicion))var moduloEdicion=function(){var mapaIds={},activarEdicionOk=!1,activarEdicion=function(){1!=activarEdicionOk&&"undefined"!=typeof Backbone&&(Backbone.sync=function(a,o,n){try{var t=o.toJSON(),i=t["@subject"];o.isNew()&&(i in mapaIds?t["@subject"]=mapaIds[i]:(t["@subject"]="<"+(new Date).getTime()+"_"+Math.floor(10*Math.random()+1)+">",mapaIds[i]=t["@subject"]));var e=t["@subject"],r=t["@type"],u=/(viejs\.org\/ns\/)(.*)(>)/g.exec(r),c=null;u&&(c=u[2]);var l=/(<)(.*)(>)/g,d=l.exec(e);if(null==d)return void n.error("error: no es identificador "+e);var s=d[2],f={};for(var m in t){var u=/(viejs\.org\/ns\/)(.*)(>)/g.exec(m);u&&(f[u[2]]=t[m])}var p={};switch(p.payload=f,p.leng=LENGUAJE,a){case"create":case"update":moduloActividad.on(),$.ajax({type:"PUT",url:"/rest/"+(null===c||void 0===c?"Documento":c)+"/"+s,data:JSON.stringify(p),contentType:"application/json; charset=utf-8"}).done(function(a){n.success(o)}).fail(function(a,o){n.error("error")}).always(function(){moduloActividad.off()})}}catch(a){n.error("error "+a)}},activarEdicionOk=!0)},activarPaginacion=function activarPaginacion(nodo){function activatePageA(actual){var cursor=actual.attr("data-next"),busqueda=JSON.parse(actual.attr("data-q")),template=actual.attr("data-tpl"),target=actual.attr("data-target"),ipage=parseInt(actual.attr("data-page"));busqueda.n||(busqueda.n=100),moduloApp.esAdmin()||actual.html(ipage*busqueda.n+1+" al "+(ipage+1)*busqueda.n),"1"===actual.attr("data-noa")&&(actual.removeAttr("href"),actual.on("click",function(){var docHtml=document.getElementById(template).innerHTML,destino=$(target),postload=destino.attr("data-postload");destino.length>0&&(moduloActividad.on(),$.ajax({type:"PUT",url:"/paginar/",data:JSON.stringify({busqueda:busqueda,cursor:cursor}),contentType:"application/json; charset=utf-8"}).done(function(msg){var datos=msg.datos,sigui=msg.next;destino.empty();for(var i=0;i<datos.length;i++){var dato=datos[i],nuevo=$(docHtml);llenarTemplate(nuevo,dato),destino.append(nuevo)}if(void 0!==sigui&&sigui.length>0){var padrePaginacion=actual.closest(".paginacion");if(0==padrePaginacion.find("[data-next='"+sigui+"']").length){for(var padreLocal=actual.parent(),nombreTAG=padreLocal.prop("tagName"),cambio=!1;padreLocal.get(0)!=padrePaginacion.get(0)&&"BODY"!=nombreTAG;)cambio=!0,actual=padreLocal,padreLocal=padreLocal.parent(),nombreTAG=padreLocal.prop("tagName");var paginaSigui=actual.clone(),paginaSigui2;paginaSigui2=cambio?paginaSigui.find("[data-next]"):paginaSigui,paginaSigui2.attr("data-page",ipage+1),paginaSigui2.attr("data-next",sigui),padrePaginacion.append(paginaSigui),activatePageA(paginaSigui2)}}void 0!==postload&&eval(postload)}).fail(function(a,o){moduloMenus.mostrarMenuSoloTexto("Error paginando")}).always(function(){moduloActividad.off()}))}))}hayValor(nodo)||(nodo=$("body")),$.each(nodo.find("a[data-next]"),function(a,o){activatePageA($(o))})},funcElegirBorrar=function(){var a=$(".btnEliminar");a.length>0?a.remove():$("[about]").each(function(a,o){var n=$(o),t=n.find(".btnEliminar");if(0==t.length){n.prepend($('<div class="btnEliminar"><div class="btnEliminarX btnEliminar2 manito"></div></div>')),t=n.find(".btnEliminar");t.find(".btnEliminar2").click(function(){var a=moduloMenus.confirmar();$.when(a).then(function(){var a=n,o=a.attr("about"),t=null;t=a.attr("typeof");var i=(hayValor(t)?t:"")+"_"+o;i in mapaIds&&(o=mapaIds[i]),moduloActividad.on(),$.ajax({type:"DELETE",url:"/rest/"+(hayValor(t)?t:"")+"/"+o}).done(function(o){a.remove(),$("body").data("Midgard-midgardNotifications").create({body:JSON.stringify(o)}),location.reload()}).fail(function(a,o){$("body").data("Midgard-midgardNotifications").create({body:TRADUCTOR.error_ajax[LENGUAJE]})}).always(function(){moduloActividad.off()}),moduloMenus.sacarUltimo()},function(){moduloMenus.sacarUltimo()})})}}),"menu"===pila[pila.length-1]&&pila.pop()};return activarPaginacion(),{activarPaginacion:activarPaginacion,activarEdicion:activarEdicion,funcElegirBorrar:funcElegirBorrar}}();var pila=[];!function(a){moduloEdicion.activarEdicion()}(jQuery);