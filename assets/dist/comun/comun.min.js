var pila=[];!function($){function crearPartes(a,i,e,t){var n='<div id="loadingDiv" class="invisible">Espere por favor...</div><div class="menu_core invisible"><ul>';e?(t&&(n+='<li><a href="/configurar.html" target="_blank">Configurar</a></li>',n+="<li><a class=\"menuEliminar manito\" onclick=\"$('.menu_core').toggleClass('invisible');\">Borrar</a></li>",n+="<li><a class=\"clearmemcache manito\" onclick=\"$('.menu_core').toggleClass('invisible');\">Borrar memoria</a></li>",n+="<li><a class=\"create-ui-toggle2 manito\" onclick=\"$('.menu_core').toggleClass('invisible');\">Editar</a></li>",n+='<li><a class="manito" onclick="manejoPopUps.mostrarMenuPagina()">Propiedades de p&aacute;gina</a></li>'),n+='<li><a href="'+i+'">Salir</a></li>'):(n+='<li><a href="'+a+'">Ingresar</a></li>',n+='<li><a href="'+i+'">Salir</a></li>'),n+="</ul></div>",jQuery("body").append(jQuery(n))}function activatePageA(actual){var cursor=actual.attr("data-next"),busqueda=JSON.parse(actual.attr("data-q")),template=actual.attr("data-tpl"),target=actual.attr("data-target"),ipage=parseInt(actual.attr("data-page"));busqueda.n||(busqueda.n=100),IS_ADMIN||actual.html(ipage*busqueda.n+1+" al "+(ipage+1)*busqueda.n),"1"===actual.attr("data-noa")&&(actual.removeAttr("href"),actual.on("click",function(){var docHtml=document.getElementById(template).innerHTML,destino=$(target),postload=destino.attr("data-postload");destino.length>0&&(waitOn(),$.ajax({type:"PUT",url:"/paginar/",data:JSON.stringify({busqueda:busqueda,cursor:cursor}),contentType:"application/json; charset=utf-8"}).done(function(msg){var datos=msg.datos,sigui=msg.next;destino.empty();for(var i=0;i<datos.length;i++){var dato=datos[i],nuevo=$(docHtml);llenarTemplate(nuevo,dato),destino.append(nuevo)}if(void 0!==sigui&&sigui.length>0){var padrePaginacion=actual.closest(".paginacion");if(0==padrePaginacion.find("[data-next='"+sigui+"']").length){for(var padreLocal=actual.parent(),nombreTAG=padreLocal.prop("tagName"),cambio=!1;padreLocal.get(0)!=padrePaginacion.get(0)&&"BODY"!=nombreTAG;)cambio=!0,actual=padreLocal,padreLocal=padreLocal.parent(),nombreTAG=padreLocal.prop("tagName");var paginaSigui=actual.clone(),paginaSigui2;paginaSigui2=cambio?paginaSigui.find("[data-next]"):paginaSigui,paginaSigui2.attr("data-page",ipage+1),paginaSigui2.attr("data-next",sigui),padrePaginacion.append(paginaSigui),activatePageA(paginaSigui2)}}void 0!==postload&&eval(postload),waitOff()}).fail(function(a,i){console.log("error"),waitOff()}))}))}var mapaIds={};"undefined"!=typeof Backbone&&(Backbone.sync=function(a,i,e){try{var t=i.toJSON(),n=t["@subject"];i.isNew()&&(n in mapaIds?t["@subject"]=mapaIds[n]:(t["@subject"]="<"+(new Date).getTime()+"_"+Math.floor(10*Math.random()+1)+">",mapaIds[n]=t["@subject"]));var r=t["@subject"],o=t["@type"],l=/(viejs\.org\/ns\/)(.*)(>)/g.exec(o),d=null;l&&(d=l[2]);var c=/(<)(.*)(>)/g,s=c.exec(r);if(null==s)return void e.error("error: no es identificador "+r);var u=s[2],p={};for(var g in t){var l=/(viejs\.org\/ns\/)(.*)(>)/g.exec(g);l&&(p[l[2]]=t[g])}var m={};switch(m.payload=p,m.leng=LENGUAJE,a){case"create":case"update":$.ajax({type:"PUT",url:"/rest/"+(null===d||void 0===d?"Documento":d)+"/"+u,data:JSON.stringify(m),contentType:"application/json; charset=utf-8"}).done(function(a){e.success(i)}).fail(function(a,i){e.error("error")})}}catch(a){e.error("error "+a)}});var funcBorrarCache=function(){waitOn(),$.ajax({type:"GET",url:"/act/clearmemcache",data:JSON.stringify({}),contentType:"application/json; charset=utf-8"}).done(function(a){0==a.error?$("body").data("Midgard-midgardNotifications").create({body:TRADUCTOR.cache_borr_ok[LENGUAJE]}):$("body").data("Midgard-midgardNotifications").create({body:JSON.stringify(a)}),waitOff()}).fail(function(a,i){$("body").data("Midgard-midgardNotifications").create({body:TRADUCTOR.error_ajax[LENGUAJE]}),waitOff()}),"menu"===pila[pila.length-1]&&pila.pop()},funcElegirBorrar=function(){var a=$(".btnEliminar");a.length>0?a.remove():$("[about]").each(function(a){var i=$(this),e=i.find(".btnEliminar");if(0==e.length){i.prepend($('<div class="btnEliminar"><div class="btnEliminarX btnEliminar2 manito"></div><div class="btnEliminarX opciones invisible">\t<div class="btnEliminar3"></div>\t<div class="btnEliminar4 manito">Cancelar</div>\t<div class="btnEliminar5 manito">Aceptar</div></div></div>')),e=i.find(".btnEliminar");var t=e.find(".btnEliminar2"),n=e.find(".btnEliminar4"),r=e.find(".btnEliminar5");t.click(function(){var a=$(this);a.addClass("invisible"),a.siblings(".opciones").removeClass("invisible")}),r.click(function(){var a=$(this),i=a.closest("[about]");if(i.length>0){var e=i.attr("about"),t=null;t=i.attr("typeof");var n=(null===t||void 0===t?"":t)+"_"+e;n in mapaIds&&(e=mapaIds[n]),waitOn(),$.ajax({type:"DELETE",url:"/rest/"+(null===t||void 0===t?"":t)+"/"+e}).done(function(a){i.remove(),$("body").data("Midgard-midgardNotifications").create({body:JSON.stringify(a)}),waitOff(),location.reload()}).fail(function(a,i){$("body").data("Midgard-midgardNotifications").create({body:TRADUCTOR.error_ajax[LENGUAJE]}),waitOff()})}}),n.click(function(){var a=$(this);a.closest(".opciones").addClass("invisible"),a.closest(".btnEliminar").find(".btnEliminar2").removeClass("invisible")})}}),"menu"===pila[pila.length-1]&&pila.pop()},abrirToolBar=function(){"full"===$("body").data("Midgard-midgardToolbar").options.display?($("body").data("Midgard-midgardToolbar").__proto__.hide(),$("body").data("Midgard-midgardToolbar").options.display="minimized"):($("body").data("Midgard-midgardToolbar").__proto__.show(),$("body").data("Midgard-midgardToolbar").options.display="full"),"menu"===pila[pila.length-1]&&pila.pop()};crearPartes(URL_LOGIN,URL_LOGOUT,HAS_USER,IS_ADMIN),$(".create-ui-toggle2").click(abrirToolBar),$(".menuEliminar").click(funcElegirBorrar),$(".clearmemcache").click(funcBorrarCache),$(document).keyup(function(a){if(27==a.keyCode)if(0==pila.length)pila.push("menu"),$(".menu_core").removeClass("invisible");else{var i=pila[pila.length-1];"menu"===i&&$(".menu_core").addClass("invisible"),"formhtml"===i&&$(".formhtml").addClass("invisible"),"menu_pagina"===i&&($(".menu_pagina").addClass("invisible"),$(".menu_core").removeClass("invisible")),pila.pop()}}),$("a[data-next]").each(function(a,i){activatePageA($(i))})}(jQuery);